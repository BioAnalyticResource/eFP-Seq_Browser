const version="v1.3.14-p20221102";let locus,colouring_mode="abs";null!=document.getElementById("locus")&&(locus=document.getElementById("locus").value);let new_locus,yscale_input,max_abs_scale,old_locus=locus;null!=document.getElementById("yscale_input")&&(yscale_input=document.getElementById("yscale_input").value),null!=document.getElementById("rpkm_scale_input")&&(max_abs_scale=document.getElementById("rpkm_scale_input").value);let locus_start=10326918,locus_end=10330048,splice_variants="",rnaseq_calls=[],exp_info=[],rnaseq_success=0;const date_obj=new Date;let rnaseq_success_current_time,rnaseq_success_end_time,rnaseq_success_start_time=date_obj.getTime(),max_absolute_fpkm=-1,max_log_fpkm=-1,svg_colouring_element=null,gene_structure_colouring_element=null,base_src="cgi-bin/data/bamdata_araport11.xml",upload_src="",dataset_dictionary={"Araport 11 RNA-seq data":"cgi-bin/data/bamdata_araport11.xml","Developmental transcriptome - Klepikova et al":"cgi-bin/data/bamdata_Developmental_transcriptome.xml"},loadNewDataset=!1,count_bam_entries_in_xml=113;function count_bam_num(){const e=new XMLHttpRequest,t=base_src;e.responseType="document",e.onreadystatechange=()=>{if(e.readyState===XMLHttpRequest.DONE&&200===e.status){const t=e.responseXML;t&&t.getElementsByTagName("file")?count_bam_entries_in_xml=e.responseXML.getElementsByTagName("file").length:null==t&&console.log("failed at response"),document.getElementById("testing_count").innerHTML=count_bam_entries_in_xml}},e.open("GET",t),e.send()}function loadingScreen(e=!0){if(!1===e){document.getElementById("loading_screen").className="loading",document.getElementById("body_of").className="body_of_loading",document.getElementById("bodyContainer").classList.add("progressLoading"),document.getElementById("loading_screen").removeAttribute("hidden");const e=document.getElementsByClassName("disableOnLoading");for(const t of e)$("#"+t.id).prop("disabled",!0)}else{document.getElementById("loading_screen").className="loading done_loading",document.getElementById("body_of").className="body_of_loading body_of_loading_done",document.getElementById("bodyContainer").classList.remove("progressLoading"),document.getElementById("loading_screen").setAttribute("hidden",!0);const e=document.getElementsByClassName("disableOnLoading");for(const t of e)$("#"+t.id).prop("disabled",!1);addGFF(),uploadingData=!1}}count_bam_num();const img_loading_base64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAAyCAYAAADP/dvoAAAABmJLR0QAwADAAMAanQdUAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAAB3RJTUUH4AoRDzYeAMpyUgAABGJJREFUeNrt3TFoE3scwPGvjxtOzKAQMEOECBkyROhQsWOEChURBFtssdJFB9Gl4OJkwaEtRRAUdLAUqYJgwamIEFAwUoS43RCw0AwpOjhkuCHDQd5Qes9q+7A+7cP2+1na5K53cH/Kl19yIfu63W4XSZL2qL+8BJIkQyhJ0h4VfPvExMSEV0WStGt92zknQkmSE+GPFFOSpN00CToRSpJkCCVJhlCSJEMoSZIhlCTJEEqSZAglSTKEkiQZQkmSDKEkSYZQkiRDKEmSIZQkyRBKe8HDhw/5/Pnzbzn2/v3709/Hx8d/23kkGULpp01PT9NoNH7LsTudDgBJktBut0mSxAsu/Q8CL4G0fUmSEEURcRxTLpc5ePBguu3Lly9EUUQ2m6VcLm/4u0ajQRzH9PT0/PNPGARcu3aNXC6X7lMqlVheXv5u3/Xt69NjJpOht7fXBZEMobRz2u02Z8+eJY5jCoUCtVqN58+fU6lUePLkCXfu3KGnp4d6vU5vby9zc3PA2peCzs7OUiqVvjvm8ePHWVlZoVAocPr0aQYHB6nX6zSbTSqVSnqMkZGRdHp88+YNw8PDzM/PuyiSIZR2zv3798lms7x9+xZYex/x5s2bLC0tce7cOYaHhwmCgHa7zaFDh5ibm6PZbDI9Pc3Hjx/J5/MsLCxQrVa3PMfhw4d5/fo1rVaLI0eOMDk5CUC1WuXTp08EQcCxY8e4cOGCCyIZQmlnffjwgfPnz6ePBwYGuHr1KrD2UmW1WqVWq7G6upru02w2yeVy5PN5AAYHB//1HOvb1/fvdDpkMhniOGZ5eZlCoUCSJOnLqZIMobRjkiRJb3RZF4YhAFNTUywuLnLr1i2KxSKPHj36df+sQUChUODSpUt0Oh0uXrzo+4PSL+Bdo9I2nThxgsePH6d3eS4sLDAwMADA+/fvOXPmDP39/RtiWSqVaLVaRFEEwN27d7d93iiKCIKA27dv8+DBAy5fvpxuazQa1Ov1dHp89uxZuq1ardJqtVw4yYlQ2r4wDDl58mT6eGZmhuvXr/Pu3TuOHj1KJpMhDENevHgBwNjYGFeuXOHVq1eEYUg2mwUgl8sxMzPDqVOnyOfz9PX1pS97/sgkCFAul2m32zx9+pQkSajVaoyOjjI5Ocns7CxRFPHy5UuiKGJkZIT+/n6y2Szj4+OMjY1x48YNF1TaxL5ut9v9+omJiYkNPyVtLo5jkiTZ8NEJWPv4BJBG8GudTockSchkMts+39TUFKurq9y7dw+Aer3O0NAQKysrLob0A7bqmxOh9JO2itlmAfx6wvxZfX19DA0NEYYhBw4cYHFxkdHRURdC+o8MofSHqFQqLC0tUavVAJifn9/0M4mSDKG0axWLRYrFohdC+oW8a1SSZAglSTKEkiQZQkmSDKEkSYZQkiRDKEmSIZQkyRBKkmQIJUkyhJIkGUJJkgyhJEmGUJKkP9mWX8PkN9RLkpwIJUna5fZ1u92ul0GS5EQoSdIe9DfEVWhcl8IjHgAAAABJRU5ErkJggg==";let img_gene_struct_1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAAIBAMAAACYMuIQAAAAFVBMVEX///8AAADcFDz/jAAAAP+m 3KYAfQDytQt7AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAATklEQVQ4jWNgYGANxQnC0iAggQEE0mAA lYcFgBWw4RZIQOEmYJNF0Q4zAQ4Qkqm4XQ8CIMWMw96HgsPdh4zD3oeCwx2MgDgc/vlw2JelAO7V xD0GmsY3AAAAAElFTkSuQmCC ";const img_gene_struct_error="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcIAAAAICAIAAADlfmh0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAMBSURBVGhD7Vi7ceswEGQrVBUMxC40wwKYKVANDpwpVuIqVIx6ealxHxzuA9BPsmfMGQOzgQgs7hZH3RrW8O/20dHR0dHxMrqN7gbneZAxLg/3GAlh13R6r8QhmgYQDtc3/Py2TMOwni2hCtg13/UM7M1x/gh06b6JHwxVx2X9zzfb8W10G90NXF/JozhdnNEmCKsNGgUU6EQtTgTsetZG99DJv6Xh18/eEtDt9efRbXQ30O6mH8XpwszjdFDWBu0BF9K40XmlTqSDj/M6ljssBqeBKXDXRASagb0c536k+WE4XjjL7f3KZJ4sHH1HRgF5QFgfKggzoRxnXO5GdluD04mPcGQfwQR/5CNXimNE+rwxi4RKM1ZVYKoPGwfPJc2px4P6ktDwBfGn6HgV3UZ3g9QSeWQ35BH/W6cZaCrXP6m74kbxSmICoWaj9MGR5fIiBPFrMQJYoj50N53yiB1bOCyM5tER0llgMoaKwjY4GBMhqYuGls6sDQoowurB5cgtTqmeSZHgs7SrB0x4rYmZ/m7B0tfFyVkKxy+JHi+sNtPxHLqN7gbwvVctmh+LV4YZ5U0J0Ay52exGB53oK2+iYXvYGwHKKAOWKJHqTyXGuhUKwAHBK6GCsAYnn8jJVhqaOrkIiYlBKgfX5WpxbPVU3nqWjerx0mUdl+sxbQE/rTO1NgRwuM5ZgJOqhfmlEqfjKXQb3Q1cS8gjt19rRrcErkaafKDI+Ehtg52J/Q+7jBGA8cE9ER5zx1KQPANxJCPtdSgdWxLpNpZ7lmyJoYKwBgeVkF9r2TpdUyc4Ow5YrR2cg8uRaxwrUuetZdmsHjDX0zKlFOd5Os4TESJTa0PYFwoCNgoSlkqcjqfQbXQ3wO89j3ShKB2C7Ycd5WfsDUuZhaU5G7W51C5q0dxmzIHfQ9kp3G+UYgTUkDxMV/M8SBUTYeUMpYQ62YeKwuqcnNfJNhqaOrmMJMxF0MGN9zlOQ6Q6rMmyWT1iQhx8dxJk6+CMXGd8WZX3qIWFpY5XcPv4BMHOh4rKP1r3AAAAAElFTkSuQmCC",absolute_rpkm_scale="iVBORw0KGgoAAAANSUhEUgAAAGQAAAAPCAMAAAAlD5r/AAABQVBMVEX///8AAADcFDz/jAAAAP+m 3KYAfQD//wD//AD/+QD/9wD/9AD/8gD/7wD/7QD/6gD/6AD/5QD/4gD/4AD/3QD/2wD/2AD/1gD/ 0wD/0QD/zgD/zAD/yQD/xgD/xAD/wQD/vwD/vAD/ugD/twD/tQD/sgD/rwD/rQD/qgD/qAD/pQD/ owD/oAD/ngD/mwD/mQD/lgD/kwD/kQD/jgD/jAD/iQD/hwD/hAD/ggD/fwD/fAD/egD/dwD/dQD/ cgD/cAD/bQD/awD/aAD/ZgD/YwD/YAD/XgD/WwD/WQD/VgD/VAD/UQD/TwD/TAD/SQD/RwD/RAD/ QgD/PwD/PQD/OgD/OAD/NQD/MwD/MAD/LQD/KwD/KAD/JgD/IwD/IQD/HgD/HAD/GQD/FgD/FAD/ EQD/DwD/DAD/CgD/BwD/BQD/AgCkIVxRAAAAs0lEQVQ4jWNg5+Dk4ubh5eMXEBQSFhEVE5eQlJKW kZWTV1BUUlZRVVPX0NTS1tHV0zcwNDI2MTUzt7C0sraxtbN3cHRydnF1c/fw9PL28fXzDwgMCg4J DQuPiIyKjomNi09ITEpOSU1Lz8jMYhi1hERLGBmpbgljbBwjiiWMnFyMVLcECOhkCZBIZUzPYKSV JaDgYkxKZkxNY2SkmU8gljDCLaFdxDMmw4NrGOWTUUuItwQAG8496iMoCNwAAAAASUVORK5CYII= ",relative_rpkm_scale="iVBORw0KGgoAAAANSUhEUgAAAGQAAAAPCAMAAAAlD5r/AAABQVBMVEX///8AAADcFDz/jAAAAP+m 3KYAfQAAAP8FBfkKCvQPD+8UFOoZGeUeHuAjI9soKNYtLdEzM8w4OMY9PcFCQrxHR7dMTLJRUa1W VqhbW6NgYJ5mZplra5NwcI51dYl6eoR/f3+EhHqJiXWOjnCTk2uZmWaenmCjo1uoqFatrVGysky3 t0e8vELBwT3GxjjMzDPR0S3W1ijb2yPg4B7l5Rnq6hTv7w/09Ar5+QX//wD/+wD/9gD/8QD/7AD/ 5wD/4gD/3QD/2AD/0wD/zQD/yAD/wwD/vgD/uQD/tAD/rwD/qgD/pQD/oAD/mgD/lQD/kAD/iwD/ hgD/gQD/fAD/dwD/cgD/bQD/ZwD/YgD/XQD/WAD/UwD/TgD/SQD/RAD/PwD/OgD/NAD/LwD/KgD/ JQD/IAD/GwD/FgD/EQD/DAD/BwBUljDTAAAA1klEQVQ4jWNg5+Dk4ubh5eMXEBQSFhEVE5eQlJKW kZWTV1BUUlZRVVPX0NTS1tHV0zcwNDI2MTUzt7C0sraxtbN3cHRydnF1c/fw9PL28fXzDwgMCg4J DQuPiIyKjomNi09ITEpOSU1Lz8jMYhi1hDRLGDi5GICWMBBvCSMjIUsYY+MYUS0BApJ8wmhlzUjI EiDAYgkD0CcMwgxUtQRIpDKmZzCiBBcDgwgDlSwBBRdjUjJjahojI2qcMAhT2RJGNEuAYUasJURH PGMyPLiGTz4ZtYQESwCEoDnh8dGTkQAAAABJRU5ErkJggg==",exon_intron_scale="iVBORw0KGgoAAAANSUhEUgAAALQAAAAPBAMAAAC/7vi3AAAAGFBMVEX///9QUFAAAADcFDz/jAAA AP+m3KYAfQCnICW7AAAArklEQVQ4jd3UMQ+CQAwF4OaG66ourpcO/DCGm7v17/vKBUU8SozBGBvy xo9HD6DzB3OicK4WTa7RfIGWgiiH0In6tBK/iMpKhsvyWAfB7NGlJEHQFA+6U5ZVjf2OTtfBI6YF OgIpadkaklGjZtrepIsXL63+U2s8vzHpila+0zsLEQe9ty+kQ7OuFgJ+pseY3nr5cIxtIQt6OkY/ 3lxReHMhF4nm1z+Zv6KP+/PdANuwQcLhhEyQAAAAAElFTkSuQmCC";function generate_colour(e,t,n){e=e.replace(/^\s*#|\s*$/g,""),t=t.replace(/^\s*#|\s*$/g,""),3==e.length&&(e=e.replace(/(.)/g,"$1$1")),3==t.length&&(t=t.replace(/(.)/g,"$1$1"));let a=parseInt(e.substr(0,2),16),o=parseInt(e.substr(2,2),16),s=parseInt(e.substr(4,2),16),l=parseInt(t.substr(0,2),16)-a,i=parseInt(t.substr(2,2),16)-o,r=parseInt(t.substr(4,2),16)-s;return l=(l*n+a).toString(16).split(".")[0],i=(i*n+o).toString(16).split(".")[0],r=(r*n+s).toString(16).split(".")[0],1==l.length&&(l="0"+l),1==i.length&&(i="0"+i),1==r.length&&(r="0"+r),"#"+l+i+r}function round(e,t){return parseFloat(e.toFixed(t))}let colouring_part;function colour_part_by_id(e,t,n,a){colouring_part="all";for(const r of sraList)e.replace("_svg","")==r&&(colouring_part=sraDict[r].svg_part);let o,s,l=n;l=Array.isArray(l)?l[variantPosition]:parseFloat(l),max_abs_scale=document.getElementById("rpkm_scale_input").value,(!max_abs_scale||max_abs_scale<=0)&&(max_abs_scale=1e3),document.getElementById(e)&&(o=document.getElementById(e).getElementsByTagName("path"),s=document.getElementById(e).getElementsByTagName("g"));let i=null;if(o&&s&&(i=Array.prototype.slice.call(o).concat(Array.prototype.slice.call(s))),null!=i){if("abs"==a){const e=255,t=255-parseInt(l/max_abs_scale*255),n=0;if("all"==colouring_part)for(const a of i)a.style.fill="rgb("+e+", "+t+", "+n+")";else for(const a of i)if(a.id==colouring_part)if("g"==a.tagName){const o=a.getElementsByTagName("path");for(const a of o)a.style.fill="rgb("+e+", "+t+", "+n+")"}else a.style.fill="rgb("+e+", "+t+", "+n+")"}else if("rel"==a){let e="";const t=3;let n=0;if("Missing controls data"!=l&&Math.abs(l)>t?n=t:"Missing controls data"!=l&&(n=Math.abs(l)),n/=t,"Missing controls data"==l?e="#D9D9D9":l>0?e=generate_colour("FFFF00","FF0000",n):0==l?e="FFFF00":l<0&&(e=generate_colour("FFFF00","0000FF",n)),"all"==colouring_part)for(const a of i)a.style.fill=e;else for(const a of i)if(a.id==colouring_part)if("g"==a.tagName){const t=a.getElementsByTagName("path");for(const n of t)n.style.fill=e}else a.style.fill=e}document.getElementById(e.replace("_svg","_rpkm")).innerHTML="Missing controls data"==l?l:round(l,2)}else console.log("Paths is null for id = "+e)}let rpkmAverage=1,rpkmMedian=1;function findRPKMValuesAcrossAll(){if(sraDict){const e=Object.keys(sraDict),t=[];let n=0;for(const a of e)if(sraDict[a].RPKM){const e=sraDict[a].RPKM[variantPosition];parseFloat(e)&&(t.push(e),n+=e)}t.length>0&&(rpkmMedian=math.median(t)),rpkmAverage=n/e.length}else displayError("ERROR IN RETRIEVING ALL DATA POINTS WITHIN DATASET")}function switchRPKMMode(e){let t=!1;"rel_radio"===e&&(t=!0),t?(colouring_mode="rel",document.getElementById("abs_radio").classList.remove("active"),document.getElementById("rel_radio").classList.add("active"),$("#rpkm_scale_input").prop("disabled",!0)):(colouring_mode="abs",document.getElementById("rel_radio").classList.remove("active"),document.getElementById("abs_radio").classList.add("active"),$("#rpkm_scale_input").removeAttr("disabled")),rnaseq_calls&&rnaseq_calls.length>0&&whichAbsOrRel()}function colour_svgs_now(){const e=colouring_mode;for(let t=0;t<count_bam_entries_in_xml;t++){if(exp_info[t]){const e=exp_info[t][0].slice(0,-4);let n=0,a=0,o=0;for(let r=0;r<count_bam_entries_in_xml;r++)-1!=exp_info[t][2].indexOf(exp_info[r][0].slice(0,-4))&&(a++,n+=exp_info[r][3][variantPosition]);0===n&&sraDict[e].RPKM&&(n=sraDict[e].RPKM[variantPosition]),a>0?o=n/a:(rpkmMedian&&1===rpkmMedian&&findRPKMValuesAcrossAll(),o=rpkmMedian);let s=0;const l=[];let i="";i=sraDict[e].RPKM&&sraDict[e].RPKM[variantPosition]?sraDict[e].RPKM[variantPosition]:0,0==i&&0==o?exp_info[t].splice(4,1,0):s=Math.log2(i/o),l.push(s),sraDict[e].relativeRPKM=s,exp_info[t].splice(4,1,l),exp_info[t].splice(6,1,o),i>=max_absolute_fpkm&&(max_absolute_fpkm=i),"Missing controls data"!=exp_info[t][4]&&Math.abs(exp_info[t][4])>=max_log_fpkm&&Math.abs(exp_info[t][4])<1e3&&(max_log_fpkm=Math.abs(exp_info[t][4])),"rel"===colouring_mode?exp_info[t][4]||0==exp_info[t][4]||(exp_info[t][4]=-999999):exp_info[t][3][variantPosition]||0==exp_info[t][3][variantPosition]||(exp_info[t][3][variantPosition]=-999999)}else logError("Issue retrieving exp_info for "+e+" within BAM entry point "+t);whichAbsOrRel()}document.getElementById("landing").setAttribute("hidden","true"),$("#theTable").trigger("update"),change_rpkm_colour_scale(colouring_mode)}function get_input_values(){locus=document.getElementById("locus").value,locus=locus.trim().toUpperCase(),yscale_input=document.getElementById("yscale_input").value,("Auto"==yscale_input||parseInt(yscale_input)<1)&&(yscale_input=parseInt(-1)),max_abs_scale=document.getElementById("rpkm_scale_input").value}function update_all_images(e){null!=document.getElementById("locus")&&(new_locus=document.getElementById("locus").value,new_locus===old_locus?($.xhrPool.abortAll(),variants_radio_options(e)):new_locus!=old_locus&&(getGFF(new_locus),old_locus=new_locus,setTimeout((function(){$.xhrPool.abortAll(),variants_radio_options(e)}),1650)))}function variants_radio_options(e){get_input_values(),$.ajax({url:"./cgi-bin/get_gene_structures.cgi?locus="+locus,dataType:"json",success:function(t){locus_start=t.locus_start,locus_end=t.locus_end,splice_variants=JSON.stringify(t.splice_variants),populate_table(e),populate_efp_modal(e);const n=document.getElementById("variants_div");if(null!==n&&null!==n.firstChild&&void 0!==n.firstChild)for(;n.firstChild;)n.removeChild(n.firstChild);$("#variant_select").ddslick("destroy");let a='<select id="variant_select">';if(t.variant_count&&parseInt(t.variant_count)>0)for(let e=0;e<parseInt(t.variant_count);e++)t.splice_variants&&t.splice_variants[e]&&t.splice_variants[e].gene_structure&&(a+='<option value="'+e+'"',a+=' data-imagesrc="data:image/png;base64,'+t.splice_variants[e].gene_structure+'" style="max-width:none;"></option>');else a+='<option value="'+i+'"',a+=' data-imagesrc="'+img_gene_struct_error+'" style="max-width:none;"></option>';if(t.splice_variants&&t.splice_variants[0]&&t.splice_variants[0].gene_structure){img_gene_struct_1="data:image/png;base64,"+t.splice_variants[0].gene_structure;const e=document.getElementsByClassName("gene_structure_img");for(const n of e)n.src="data:image/png;base64,"+t.splice_variants[0].gene_structure}else{img_gene_struct_1=img_gene_struct_error;const e=document.getElementsByClassName("gene_structure_img");for(const n of e)n.src="data:image/png;base64,"+t.splice_variants[0].gene_structure}$("input[type=radio][name=radio_group]").change((function(){gene_structure_radio_on_change()})),a+="</select></div>",$("#variants_div").append(a),document.getElementById("variant_select")&&$("#variant_select").ddslick({width:"100%",onSelected:function(){gene_structure_radio_on_change()}}),document.getElementById("landing").setAttribute("hidden","true"),$("#theTable").trigger("update")},error:function(){displayError("ERROR IN get_gene_structures !")}})}function displayError(e){$("#displayError").empty();let t='<p class="warning_core" style="text-align:center;">'+e+" <br /><br /> PLEASE REFRESH PAGE, RELOAD OR RE-INPUT DATA OR TRY AGAIN AT A LATER TIME </p>";console.error("Error in logic:",e),$("#displayError").append(t),$("#locus_button").prop("disabled",!0),$("#abs_scale_button").prop("disabled",!0),progress_percent=100,$("div#progress").width(progress_percent+"%"),loadingScreen(!0),document.title=`eFP-Seq Browser: !ERROR! - ${locus} - ${datasetName}`}function logError(e){console.error("Error in logic:",e)}let variant_selected,variantPosition=0;function gene_structure_radio_on_change(){if(document.getElementsByClassName("dd-selected-value")&&document.getElementsByClassName("dd-selected-value")[0]&&document.getElementsByClassName("dd-selected-value")[0].value){variant_selected=document.getElementsByClassName("dd-selected-value")[0].value,variantPosition=variant_selected;let e=document.getElementsByClassName("dd-selected-image")[0].src;document.getElementsByClassName("dd-selected-image")&&document.getElementsByClassName("dd-selected-image")[0]&&!document.getElementsByClassName("dd-selected-image")[0].alt&&(document.getElementsByClassName("dd-selected-image")[0].alt="RNA-Seq Coverage");let t=document.getElementsByClassName("gene_structure_img");for(let n=0;n<t.length;n++)t[n].src=e;for(let n=0;n<exp_info.length;n++){let t=exp_info[n][0].split("_")[0];document.getElementById(t+"_gene_structure_img").src=e;let a,o=sraDict[t].r[variant_selected].toFixed(2);document.getElementById(t+"_rpb").innerHTML=o,sraDict[exp_info[n][0].split("_svg")[0]]||(sraDict[exp_info[n][0].split("_svg")[0]]={}),sraDict[exp_info[n][0].split("_svg")[0]].rpb=o,sraDict[t].RPKM&&sraDict[t].RPKM[variant_selected]?a=sraDict[t].RPKM[variant_selected].toFixed(2):sraDict[t].RPKM?logError("Unable to retrieve RPKM values at: [variant_selected] for "+t):sraDict[t]?logError('Unable to retrieve RPKM values at: ["RPKM"] for '+t):logError(sraDict?"Unable to retrieve RPKM values at: SRA within sraDict":"Unable to retrieve RPKM values at: sraDict unreachable"),document.getElementById(t+"_rpkm").innerHTML=a,whichAbsOrRel(!0,n)}}document.getElementById("landing").setAttribute("hidden","true"),$("#theTable").trigger("update")}function whichAbsOrRel(e=!1,t=0){if(!0===e)absOrRel(t);else if(exp_info.length>0)for(let n=0;n<exp_info.length;n++)absOrRel(n);change_rpkm_colour_scale(colouring_mode)}function absOrRel(e=0){let t=exp_info[e],n=t[0].slice(0,-4);if("rel"==colouring_mode&&sraDict[n].relativeRPKM){document.getElementById("compareGeneVariants").disabled=!0,t&&!t[4]&&0!=t[4]&&(t[4]=-999999);let e=sraDict[n].relativeRPKM.toFixed(2);document.getElementById(t[0].split("_svg")[0]+"_rpkm").innerHTML=e,sraDict[t[0].split("_svg")[0]].rpkm=e,colour_part_by_id(n+"_svg",sraDict[n].svg_part,sraDict[n].relativeRPKM,colouring_mode)}else{allCheckedOptions.length>0&&(document.getElementById("compareGeneVariants").disabled=!1),t[3]||0==t[3]||(t[3]=-999999);let e="";if(variant_selected&&sraDict[n].RPKM&&sraDict[n].RPKM[variant_selected]){let a=sraDict[n].RPKM[variant_selected].toFixed(2);document.getElementById(t[0].split("_svg")[0]+"_rpkm").innerHTML=a,e=a}else{let n=0;document.getElementById(t[0].split("_svg")[0]+"_rpkm").innerHTML=n,e=n}colour_part_by_id(n+"_svg",sraDict[n].svg_part,e,colouring_mode)}}function parseIntArray(e){for(let t=0,n=e.length;t<n;t++)e[t]=parseInt(e[t],10);return e}let rnaseq_image_url="cgi-bin/rnaSeqMapCoverage.cgi",match_drive="",progress_percent=0,rnaseq_change=1,totalreadsMapped_dic={},dumpOutputs="",dumpMethod="simple",callDumpOutputs=!1,rpkmCount=1,listOfRecordsDisplayed=[];function rnaseq_images(e){changePublicData();if(dumpOutputs="",data={},rnaseq_success=1,rpkmCount=1,match_drive="",listOfRecordsDisplayed=[],get_input_values(),CreateFilteredeFPList(),rnaseq_calls.length===count_bam_entries_in_xml){rnaseq_change=1;for(let t=0;t<count_bam_entries_in_xml;t++){let n=rnaseq_calls[t][0]||"undefined",a=rnaseq_calls[t][1]||"unknown";if("Google Drive"===sraDict[sraList[t]].bam_type){let e=sraDict[sraList[t]].drive_link,n=e.split("?usp=sharing");n=n[0].split("drive.google.com/drive/folders/"),match_drive=n.length>1?n[1]:e}else if("Amazon AWS"===sraDict[sraList[t]].bam_type){let e=sraDict[sraList[t]].drive_link,n=e.split("amazonaws.com/");1===n.length&&(n=e.split("araport.cyverse-cdn.tacc.cloud/")),match_drive=n.length>1?n[1]:e}data={status:e,numberofreads:sraDict[sraList[t]].numberofreads,hexcodecolour:sraDict[sraList[t]].hexColourCode,remoteDrive:match_drive,bamType:sraDict[sraList[t]].bam_type,filename:sraDict[sraList[t]].filenameIn,tissue:n,record:a,locus:locus,variant:1,start:locus_start,end:locus_end,yscale:yscale_input,cachedDatapoints:publicData,struct:splice_variants,dumpMethod:dumpMethod},$.ajax({method:"POST",url:rnaseq_image_url,data:data,dataType:"json",failure:function(){$("#failure").show()},success:function(e){let t=99;count_bam_entries_in_xml>0&&(t=parseInt((count_bam_entries_in_xml-1)/count_bam_entries_in_xml*100)),rnaseq_success++;let n=new Date;if(rnaseq_success_current_time=n.getTime(),progress_percent=rnaseq_change/count_bam_entries_in_xml*100,$("div#progress").width(progress_percent+"%"),progress_percent>t&&loadingScreen(!0),document.getElementById("progress_tooltip").innerHTML="Current progress is at "+progress_percent+"% done",document.getElementById("progress").title=progress_percent.toFixed(2)+"% ("+rnaseq_change+"/"+count_bam_entries_in_xml+")",document.title="eFP-Seq Browser:",progress_percent<100&&(document.title+=` Loading ${progress_percent.toFixed(1)}% -`),document.title+=` ${locus} - ${datasetName}`,e.status&&"success"===e.status&&e.record){let t=e.record||"unknown";if(listOfRecordsDisplayed.includes(t)?(t=findUnusedRecordDisplayName(t,listOfRecordsDisplayed),listOfRecordsDisplayed.push(t)):listOfRecordsDisplayed.push(t),listOfRecordsDisplayed=[],sraDict[t].bp_length=parseFloat(e.end)-parseFloat(e.start),sraDict[t].bp_start=parseFloat(e.start),sraDict[t].bp_end=parseFloat(e.end),sraDict[t].MappedReads=e.reads_mapped_to_locus,totalreadsMapped_dic[t]=e.totalReadsMapped,sraDict[t].locusValue=e.locus,sraDict[t].r=e.r,sraDict[t].dataVisualization=e.rnaseqbase64,locus!=e.locus)throw new Error(`ERROR: ${locus}'s RNA-Seq API request returned with data for some other locus.`);let n=[];if(e.ss_y&&e.sum_y&&e.sum_xy&&e.sum_x&&e.ss_x&&e.end&&e.start){parseInt(e.ss_y);let t=parseInt(e.sum_y),a=parseInt(e.ss_y),o=parseIntArray(e.sum_xy.replace(/\[/g,"").replace(/\]/g,"").replace(/"/g,"").split(",")),s=parseIntArray(e.sum_x.replace(/\[/g,"").replace(/\]/g,"").replace(/"/g,"").split(",")),l=(parseIntArray(e.sum_xx.replace(/\[/g,"").replace(/\]/g,"").replace(/"/g,"").split(",")),parseIntArray(e.ss_x.replace(/\[/g,"").replace(/\]/g,"").replace(/"/g,"").split(",")),parseIntArray(e.ss_x.replace(/\[/g,"").replace(/\]/g,"").replace(/"/g,"").split(","))),i=parseInt(e.end)-parseInt(e.start),r=[];for(let e=0;e<o.length;e++)r.splice(e,0,o[e]-s[e]*t/i),n.splice(e,0,r[e]/Math.sqrt(l[e]*a))}else n=e.r;if(document.getElementById(t+"_rnaseq_img")&&e.rnaseqbase64?"None"!==e.rnaseqbase64&&e.rnaseqbase64.length>=3?(document.getElementById(t+"_rnaseq_img").src="data:image/png;base64,"+e.rnaseqbase64,rnaseq_change+=1):(document.getElementById(t+"_rnaseq_img").src="https://"+window.location.host+window.location.pathname+"cgi-bin/img/error.webp",console.error("Unable to create RNA-Seq map coverage data for: Locus - "+locus+", SRA - "+t+", dataset - "+base_src)):(document.getElementById(`${t}_rnaseq_img`)&&(document.getElementById(`${t}_rnaseq_img`).src=`https://${window.location.host}${window.location.pathname}/cgi-bin/img/error.webp`),console.error("Unable to create RNA-Seq map coverage data for: Locus - "+locus+", SRA - "+t+", dataset - "+base_src)),document.getElementById(t+"_rpb").innerHTML=parseFloat(n[0]).toFixed(2),sraDict[t].rpb=parseFloat(n[0]).toFixed(2),document.getElementById(t+"_rpkm").innerHTML=e["absolute-fpkm"],updateRPKMAbsoluteMax(e["absolute-fpkm"]),sraDict[t].RPKM=e["absolute-fpkm"],rpkmCount++,document.getElementById(t+"_totalReadsNum").innerHTML="Total reads = "+e.totalReadsMapped,callDumpOutputs)if(dumpOutputs+='\t\telif (record == "'+e.record+'"):\n',"complex"==dumpMethod){for(dumpOutputs+='\t\t\tdumpJSON(200, "'+e.locus+'", '+e.variant+", "+e.chromosome+", "+e.start+", "+e.end+', "'+e.record+'", "'+e.tissue+'", "'+e.rnaseqbase64+'", '+e.reads_mapped_to_locus+", "+e["absolute-fpkm"]+", ["+e.r+"], "+e.totalReadsMapped+", ["+e.exp_arr+"], [",n=0;n<e.ReadsMappedNucleotidePosition.length;n+=2)dumpOutputs+="["+e.ReadsMappedNucleotidePosition[n]+"]",n!=e.ReadsMappedNucleotidePosition.length-2&&(dumpOutputs+=", ");dumpOutputs+="], {";for(let t=0;t<e.expected_expr_in_variant.length;t++)dumpOutputs+='"'+GFF_List[t].replace(locus,"")+'": ',dumpOutputs+="["+e.expected_expr_in_variant[t]+"]",t!=e.expected_expr_in_variant.length-1&&(dumpOutputs+=", ");dumpOutputs+="})\n"}else dumpOutputs+='\t\t\tdumpJSON(200, "'+e.locus+'", '+e.variant+", "+e.chromosome+", "+e.start+", "+e.end+', "'+e.record+'", "'+e.tissue+'", "'+e.rnaseqbase64+'", '+e.reads_mapped_to_locus+", ["+e["absolute-fpkm"]+"], ["+e.r+"], "+e.totalReadsMapped+")\n";for(let a=0;a<count_bam_entries_in_xml;a++)exp_info&&exp_info[a]&&exp_info[a][0]&&exp_info[a][0]==t+"_svg"&&(exp_info[a].splice(3,1,e["absolute-fpkm"]),exp_info[a].splice(5,1,n));colour_part_by_id(t+"_svg","Shapes",e["absolute-fpkm"][variantPosition],colouring_mode)}else if(e.status&&"fail"===e.status){let t=e.record||"unknown";listOfRecordsDisplayed.includes(t)?(t=findUnusedRecordDisplayName(t,listOfRecordsDisplayed),listOfRecordsDisplayed.push(t)):listOfRecordsDisplayed.push(t),t&&document.getElementById(`${t}_rnaseq_img`)&&(document.getElementById(`${t}_rnaseq_img`).src=`https://${window.location.host}${window.location.pathname}/cgi-bin/img/error.webp`),rnaseq_change+=1,t&&document.getElementById(t+"_rpb")&&(document.getElementById(t+"_rpb").innerHTML=null,sraDict[t]||(sraDict[t]={}),sraDict[t].rpb=null),t&&document.getElementById(t+"_rpkm")&&(document.getElementById(t+"_rpkm").innerHTML=null,updateRPKMAbsoluteMax(null),sraDict[t].RPKM=null),rpkmCount++,t&&document.getElementById(t+"_totalReadsNum")&&e.totalReadsMapped&&(document.getElementById(t+"_totalReadsNum").innerHTML="Total reads = "+e.totalReadsMapped),t&&document.getElementById(t+"_row")&&document.getElementById(t+"_row").classList.add("mainEntriesError"),console.error("Unable to create RNA-Seq map coverage data for: Locus - "+locus+", SRA - "+t+", dataset - "+base_src)}else console.log("Error!",e,data);rpkmCount==count_bam_entries_in_xml&&(colour_svgs_now(),date_obj4=new Date,rnaseq_success_end_time=date_obj4.getTime(),document.getElementById("progress_tooltip").innerHTML=rnaseq_success+" / count_bam_entries_in_xml requests completed<br/>Load time ~= "+String(round(parseInt(rnaseq_success_end_time-rnaseq_success_start_time)/6e4))+" mins."),document.getElementById("landing").setAttribute("hidden","true"),$("#theTable").trigger("update"),responsiveRNAWidthResize(),toggleResponsiveTable()}})}}}function findUnusedRecordDisplayName(e="unknown",t=sraList,n=0){if(Array.isArray(t)){let a=e+"_"+n;if(t.includes(a))findUnusedRecordDisplayName(e,t,n+1);else if(!t.includes(a))return a}else findUnusedRecordDisplayName(e,t=[])}function updateRPKMAbsoluteMax(e){let t=parseInt(document.getElementById("rpkm_scale_input").value);1e3===t&&(t=1);let n=parseInt(e);n>t&&(document.getElementById("rpkm_scale_input").value=n)}const svgAgainstData={"ath-10dayOldSeedling":{name:"10 Day Old Seedling",subunit:["all","root","shoot"]},"ath-15dayOldSeedling":{name:"15 Day Old Seedling",subunit:["all","root","shoot"]},"ath-etiolatedSeedling":{name:"Etiolated Seedling",subunit:["etiolatedseedling"]},"ath-Flower":{name:"Flower",subunit:["flower","receptacle"]},"ath-FlowerParts":{name:"Flower Parts",subunit:["all","petals","stamen","sepals","carpels"]},"ath-GerminatingSeed":{name:"Germinating Seed"},"ath-Internode":{name:"Internode"},"ath-leaf":{name:"Leaf",subunit:["leaf"]},"ath-LeafParts":{name:"Leaf Parts",subunit:["all","lamina","petiole","veins"]},"ath-Pollen":{name:"Pollen"},"ath-RootTip":{name:"Root Tip"},"ath-rosettePlusRoot":{name:"Rosette Plus Root",subunit:["all","shoot","root"]},"ath-Seed1-4":{name:"Seed 1-4"},"ath-Seed5-7":{name:"Seed 5-7"},"ath-Seed8+":{name:"Seed 8+"},"ath-SenescentLeaf":{name:"Senescent Leaf"},"ath-ShootApexInflorescense":{name:"Shoot Apex Inflorescense"},"ath-ShootApexVegetative-Transition":{name:"Shoot Apex Vegetative-Transition"},"ath-Silique1-5":{name:"Silique 1-5"},"ath-Silique6-10":{name:"Silique 6-10"},"ath-YoungLeaf1-4":{name:"Young Leaf 1-4"},"ath-EarlyBuddingFlower":{name:"Early Budding Flower",subunit:["all","shoot","buds"]},"ath-EarlyBuddingFlower":{name:"Early Budding Flower",subunit:["all","shoot","buds"]},"ath-FlowerBud":{name:"Flower Bud",subunit:["flowerBud"]},"ath-Stamen":{name:"Stamen",subunit:["all","anthers","filament"]},"ath-StigmaAndOvaries":{name:"Stigma And Ovaries",subunit:["all","Stigma_tissue","Ovary_tissue"]},"ath-WholeSilique":{name:"Whole Silique",subunit:["silique","all","seed"]},"ath-youngSeedling":{name:"Young Seedling",subunit:["all","root","hypocotyl","cotyledon"]},"ath-FlowerDevelopment1":{name:"Late Flower Development (1)",subunit:["flowerDevelopmentPart1"]},"ath-FlowerDevelopment2":{name:"Flower Development 2",subunit:["flowerDevelopmentPart2"]},"ath-FlowerDevelopment3":{name:"Flower Development 3",subunit:["flowerDevelopmentPart3"]},"ath-FlowerDevelopment4":{name:"Flower Development 4",subunit:["flowerDevelopmentPart4"]},"ath-FlowerDevelopment5":{name:"Flower Development 5",subunit:["flowerDevelopmentPart5"]},"ath-FlowerDevelopment6-8":{name:"Flower Development 6-8",subunit:["flowerDevelopmentPart6"]},"ath-FlowerDevelopment9-11":{name:"Flower Development 9-11",subunit:["flowerDevelopmentPart9"]},"ath-FlowerDevelopment12-14":{name:"Flower Development 12-14",subunit:["flowerDevelopmentPart12"]},"ath-FlowerDevelopment15-18":{name:"Flower Development 15-18",subunit:["flowerDevelopmentPart15"]},"ath-FlowerDevelopment19":{name:"Flower Development 19",subunit:["flowerDevelopmentPart19"]},"ath-Other":{name:"Other"}};function checkAgainstSVG(e,t,n=!1){let a=e.split(".")[0],o=n?svgAgainstData[a].name:t;return svgAgainstData[a]&&!n&&(svgAgainstData[a].subunit?svgAgainstData[a].subunit.includes(t)||(svgAgainstData[a].subunit_name?o=svgAgainstData[a].subunit_name:svgAgainstData[a].subunit[0]&&(o=svgAgainstData[a].subunit[0])):"all"!==t&&(o="all")),o}let efp_table_column,variantdiv_str,sraList=[],sraDict={},sraCountDic={},tissueSRADic={},datasetName="data",iteration_num=1,moreDetails='Show More Details <i class="material-icons detailsIcon">arrow_drop_down</i>',lessDetails='Show Less Details <i class="material-icons detailsIcon">arrow_drop_up</i>';function populate_table(e){$("#theTable").empty(),$("#compareTable").empty(),rnaseq_calls=[],exp_info=[],rnaseq_success=0,date_obj5=new Date,rnaseq_success_start_time=date_obj5.getTime(),max_absolute_fpkm=-1,max_log_fpkm=-1,svg_colouring_element=null,gene_structure_colouring_element=null,sraList=[],sraDict={},sraCountDic={},tissueSRADic={},rpkmAverage=1,rpkmMedian=1;$("#theTable").append('<thead><tr><th class="sortable colTitle" id="colTitle" onclick="ChangeColArrow(this.id)" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; width: 250px;"><div class="row" id="colTitleRow"><div class="col-10">Title</div><div class="col-1"><img loading="lazy" class="sortingArrow" id="colTitleArrow" src="./cgi-bin/SVGs/arrowDefault.svg" alt="Sorting arrow"></div></div></th><th class="colRNA" id="colRNA" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; max-width: 576px;">RNA-Seq Coverage<img loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAAPBAMAAAC/7vi3AAAAGFBMVEX///9QUFAAAADcFDz/jAAA AP+m3KYAfQCnICW7AAAArklEQVQ4jd3UMQ+CQAwF4OaG66ourpcO/DCGm7v17/vKBUU8SozBGBvy xo9HD6DzB3OicK4WTa7RfIGWgiiH0In6tBK/iMpKhsvyWAfB7NGlJEHQFA+6U5ZVjf2OTtfBI6YF OgIpadkaklGjZtrepIsXL63+U2s8vzHpila+0zsLEQe9ty+kQ7OuFgJ+pseY3nr5cIxtIQt6OkY/ 3lxReHMhF4nm1z+Zv6KP+/PdANuwQcLhhEyQAAAAAElFTkSuQmCC" alt="RNA-Seq mapped image" style="float: right; margin-right: 10px;"></th><th class="sortable colrpb" id="colrpb" onclick="ChangeColArrow(this.id)" title="Point biserial correlation coefficient. Closer to 1 suggests a \'best\' match" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; width: 75px;"><div class="row" id="colrpbRow"><div class="col-7" >r<sub>pb</sub></div><div class="col-1"><img loading="lazy" class="sortingArrow" id="colrpbArrow" src="./cgi-bin/SVGs/arrowDefault.svg" alt="Default sort arrow"></div></div></th><th class="coleFP" id="eFP_th" class="sortable" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; width: 100px;">eFP (RPKM)</th><th class="sortable colRPKM" id="colRPKM" onclick="ChangeColArrow(this.id)" title="Reads Per Kilobase of transcript per Million mapped reads. Higher number suggest more mapped reads/expression" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; width: 75px;"><div class="row" id="colRPKMRow"><div class="col-8">RPKM</div><div class="col-1"><img loading="lazy" class="sortingArrow" id="colRPKMArrow" src="./cgi-bin/SVGs/arrowDefault.svg" alt="Default sort arrow"></div></div></th><th class="sortable colDetails" id="colDetails" onclick="ChangeColArrow(this.id)" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; width: 275px;"><div class="row" id="colDetailsRow"><div class="col-10">Details</div><div class="col-1"><img loading="lazy" class="sortingArrow" id="colDetailsArrow" src="./cgi-bin/SVGs/arrowDefault.svg" alt="Default sort arrow"></div></div></th><th class="sortable colCompare" id="colCompare" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; max-width: 30px;" hidden><div class="row" id="colCompareRow"></div></th></tr></thead><tbody id="data_table_body"></tbody>');$("#compareTable").append('<thead><tr><th id="compare_colTitle" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; width: 250px;"><div class="row" id="compare_colTitleRow"><div class="col-xs-10">Title</div></div></th><th id="compare_colRNA" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; max-width: 576px;">RNA-Seq Coverage<img loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAAPBAMAAAC/7vi3AAAAGFBMVEX///9QUFAAAADcFDz/jAAA AP+m3KYAfQCnICW7AAAArklEQVQ4jd3UMQ+CQAwF4OaG66ourpcO/DCGm7v17/vKBUU8SozBGBvy xo9HD6DzB3OicK4WTa7RfIGWgiiH0In6tBK/iMpKhsvyWAfB7NGlJEHQFA+6U5ZVjf2OTtfBI6YF OgIpadkaklGjZtrepIsXL63+U2s8vzHpila+0zsLEQe9ty+kQ7OuFgJ+pseY3nr5cIxtIQt6OkY/ 3lxReHMhF4nm1z+Zv6KP+/PdANuwQcLhhEyQAAAAAElFTkSuQmCC" alt="RNA-Seq mapped image" style="float: right; margin-right: 10px;"></th><th id="compare_colrpb" title="Point biserial correlation coefficient. Closer to 1 suggests a \'best\' match" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; width: 75px;"><div class="row" id="compare_colrpbRow"><div class="col-xs-6">r<sub>pb</sub></div></div></th><th id="compare_eFP_th" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; width: 100px;">eFP (RPKM)</th><th id="compare_colRPKM" title="Reads Per Kilobase of transcript per Million mapped reads. Higher number suggest more mapped reads/expression" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; width: 75px;"><div class="row" id="compare_colRPKMRow"><div class="col-xs-7">RPKM</div></div></th><th id="compare_colDetails" style="border: 1px solid #D3D3D3; background-color: #F0F0F0; width: 275px;"><div class="row" id="compare_colDetailsRow"><div class="col-xs-10">Details</div></div></th></tr></thead><tbody id="compare_table_body"></tbody>'),$.ajax({url:base_src,dataType:"xml",success:function(t){$(t).find("files").each((function(){datasetName=$(this).attr("xmltitle")||"Uploaded dataset",datasetName=datasetName.trim(),0===datasetName.length&&(datasetName="Uploaded dataset"),document.getElementById("uploaded_dataset").innerHTML=datasetName})),document.title="eFP-Seq Browser:",progress_percent<100&&(document.title+=` Loading ${progress_percent.toFixed(1)}% -`),document.title+=` ${locus} - ${datasetName}`,iteration_num=1,$(t).find("file").each((function(){let t=$(this).attr("record_number")||"unknown";if(sraList.includes(t)&&(t=findUnusedRecordDisplayName(t,sraList)),sraList.includes(t)){if(sraCountDic[t]){sraCountDic[t]+=1;let e=t+"("+sraCountDic[t]+")";sraList.push(e),sraDict[e]={}}}else sraCountDic[t]=1,sraList.push(t),sraDict[t]={};let n=$(this).attr("description");sraDict[t].title=n;let a=$(this).attr("info");sraDict[t].description=a;let o=$(this).attr("svgname");sraDict[t].svg=o;let s=$(this).attr("svg_subunit");s=checkAgainstSVG(o,s),sraDict[t].svg_part=s,tissueSRADic[checkAgainstSVG(o,s,!0)]?tissueSRADic[checkAgainstSVG(o,s,!0)].push(t):tissueSRADic[checkAgainstSVG(o,s,!0)]=[t];let l=$(this).attr("url");sraDict[t].url=l;let i=$(this).attr("publication_link");sraDict[t].publicationid=i;let r,d=$(this).attr("total_reads_mapped");null!=d&&""!=d||(d="0"),sraDict[t].numberofreads=d,r=null==$(this).attr("hex_colour")||""==$(this).attr("hex_colour")?"0x64cc65":$(this).attr("hex_colour"),sraDict[t].hexColourCode=r;let c=$(this).attr("filename");null!=c&&""!=c&&null!=c||(c="accepted_hits.bam"),sraDict[t].filenameIn=c;let u=$(this).attr("species");sraDict[t].species=u;let m=[];if(null==$(this).find("controls")[0].innerHTML)for(let e=1;e<$(this).find("controls")[0].childNodes.length;e+2)m.push($(this).find("controls")[0].childNodes[e].firstChild.textContent);else null!=$(this).find("controls")[0].innerHTML&&(m=$(this).find("controls")[0].innerHTML.replace(/<bam_exp>/g,"").replace(/<\/bam_exp>/g,",").replace(/\n/g," ").replace(/ /g,"").split(","));sraDict[t].controls=m;let g="";if(m.length>0)for(let e=m.length;e--;)"MEDIAN"!=m[e]?g+='<a href="https://www.ncbi.nlm.nih.gov/Traces/sra/?run='+m[e]+'"target="_blank" rel="noopener">'+m[e]+"</a> ":g+=m[e];sraDict[t].links=g;let p="";if(m.length>0)for(let e=0;e<m.length;e++)p+=m[e].toString(),e<m.length-2&&(p+=", ");sraDict[t].controlsString=p.trim();let _=$(this).attr("name");sraDict[t].name=_;let h=$(this).attr("svgname");h&&("ath-"===h.trim().substr(0,4)&&(h=h.slice(4,h.length).trim()),".svg"===h.trim().substr(h.length-4,4)&&(h=h.slice(0,h.length-4).trim())),rnaseq_calls.push([h,t]),sraDict[t].tissue=h;let A=$(this).attr("bam_type");sraDict[t].bam_type=A;let D=$(this).attr("name");sraDict[t].drive_link=D;let f=$(this).attr("read_map_method");sraDict[t].read_map_method=f;let b="https://bioviz.org/bar.html?";b+="version=A_thaliana_Jun_2009&",b+="gene_id="+locus+"&",b+="feature_url_0="+D+"&",b+="genome=A_thaliana_Jun_2009&",b+="annotation_set=Araport11&",b+="query_url="+D+"&",b+="server_url=bar";let y='<tr class="mainEntries" id="'+t+'_row">',v="<table id='table_dl'>\n\t<tbody>\n";v+="\t\t<caption>"+document.getElementById("xmlDatabase").value+"</caption>\n",y+='<td class="colTitle" style="width: 250px; font-size: 12px;" id="'+t+'_title">'+n+"</td>\n",y+=`\n\t\t\t\t\t<td class="colRNA" style="max-width: 576px;">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tloading="lazy"\n\t\t\t\t\t\t\tid="${t}_rnaseq_img"\n\t\t\t\t\t\t\talt="RNA-Seq mapped image for: ${t}"\n\t\t\t\t\t\t\tstyle="min-width:420px; max-width:576px; width:95%; height: auto;"\n\t\t\t\t\t\t\tclass="rnaseq_img responsiveRNAWidth"\n\t\t\t\t\t\t\tsrc="${img_loading_base64}"\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t<br/>\n\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tloading="lazy"\n\t\t\t\t\t\t\tid="${t}_gene_structure_img"\n\t\t\t\t\t\t\tstyle="max-width: 576px; width:100%; height: auto;"\n\t\t\t\t\t\t\tclass="gene_structure_img"\n\t\t\t\t\t\t\tsrc="${img_gene_struct_1}"\n\t\t\t\t\t\t\talt="Gene variant image for: ${t}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</td>\n\n\t\t\t\t`,y+='<td id="'+t+'_rpb" class="rpb_value colrpb" style="font-size: 12px; width: 50px; ">'+"-9999</td>",y+='<td class="coleFP" tag="svg_name" style="width:  75px;"><div id="'+t+'_svg" name="'+o.substring(0,o.length-4).slice(4)+'_tissue" tag='+s+'_subtissue" width="75" height="75" style="width: 75px; height: 75px; max-width: 75px; max-height: 75px;">'+document.getElementById(o.substring(4).replace(".svg","_svg")).innerHTML+'</div><div class="mdl-tooltip" for="'+t+'_svg">'+o.substring(4).replace(".svg","")+"</div></td>\n",y+='<td class="colRPKM" id="'+t+'_rpkm" style="font-size: 12px; width: 50px; ">-9999</td>',y+='<td class="colDetails" id="'+t+'_details" style="font-size: 12px;"><div id="'+t+'_description" name="'+a.trim()+'">'+truncateDescription(a)+"</div>","Amazon AWS"===A&&(y+='<div id="igbLink_'+t+'">Show: <a href="'+b+'" target="_blank" rel="noopener">Alignments in IGB</a></div>'),t.includes("unknown")&&!i||(y+='<div id="extraLinks_'+t+'">Go to: ',t.includes("unknown")||(y+='<a href="'+l+'" target="_blank" rel="noopener">NCBI SRA</a>'),t.includes("unknown")&&i&&(y+=" or "),i&&(y+='<a href="'+i+'" target="_blank" rel="noopener">PubMed</a>'),y+="</div>"),y+='<a id="clickForMoreDetails_'+iteration_num+'" name="'+t+'_description" onclick="clickDetailsTextChange(this.id)" href="javascript:(function(){$(\'#'+t+"').toggle();})()\">"+moreDetails.trim()+"</a>",y+='<div id="'+t+'" class="moreDetails" style="display:none">',g&&(y+="Controls: "+g+"<br/>"),y+="Species: "+u+"<br>",y+='<div id="'+t+'_sra">SRA: '+t+"</div>",y+='<div id="'+t+'_totalReadsNum">Total reads = '+d+"</div>",null!=f&&f.length>0&&(y+='<div id="'+t+'_readMappedMethod">Read map method = '+f.trim()+"</div>"),y+='<a id="clickForMoreDetails_'+iteration_num+'_less" name="'+t+'_description" onclick="clickDetailsTextChange(this.id)" href="javascript:(function(){$(\'#'+t+"').toggle();})()\">"+lessDetails+"</a></div></td>\n",y+='<td class="colCompare" style="font-size: 12px; max-width: 30px;"><div id="'+t+'_compareVariant"><input type="checkbox" name="compareCheckbox" class="compareCheckbox" value="compareCheckbox" id="'+t+'_compareCheckbox" onclick="tableCheckbox(this.id);"></div></td>',y+="</tr>",iteration_num++,$("#theTable").append(y);let w=document.getElementsByClassName("fltrow")[0].childNodes[6];(w&&void 0===w.classList[0]||"undefined"===w.classList[0])&&(w.classList=["colCompare"],w.innerHTML='<input type="checkbox" name="compareCheckbox" class="compareCheckbox" value="compareCheckbox" id="allCheckbox" onclick="disableAllComparison();">'),exp_info.push([t+"_svg",s,m,0,0,0,0]),!0===loadNewDataset?(setTimeout((function(){count_bam_num()}),200),setTimeout((function(){rnaseq_images(e)}),10)):rnaseq_images(e)})),$.tablesorter.addParser({id:"rpb_sorter",is:function(e){return!1},format:function(e){return NaN==e?-99999:null==e?-999999:e==1/0?99999:e==-1/0?-99999:parseFloat(e)},type:"numeric"}),$.tablesorter.addParser({id:"rpkm_sorter",is:function(e){return!1},format:function(e){return NaN==e?-99999:null==e?-999999:e==1/0?99999:e==-1/0?-99999:"Missing controls data"==e?-9999999:parseFloat(e)},type:"numeric"}),$("#theTable").tablesorter({headers:{0:{},1:{sorter:!1},2:{sorter:"rpb_sorter"},3:{},4:{sorter:"rpkm_sorter"},5:{}}}),$("#theTable").trigger("update")}});new TableFilter("theTable",{base_path:"cgi-bin/core/packages/tableFilter/",columns_exact_match:[!1,!1,!1,!1,!1,!1],watermark:["Filter","Filter","Filter","Filter","Filter","Filter"],highlight_keywords:!1,no_results_message:!0,auto_filter:!0,auto_filter_delay:500,col_1:"none",popup_filters:!1,filters_row_index:1,alternate_rows:!1,msg_filter:"Filtering..."}).init(),change_rpkm_colour_scale(colouring_mode);for(let t=0;t<colSortList.length;t++){CheckElementWidth(colSortList[t]+"Arrow",8)}createVariantDiv()}function createVariantDiv(){null==gene_structure_colouring_element&&document.getElementById("flt1_theTable")&&document.getElementById("flt1_theTable").parentElement&&(gene_structure_colouring_element=document.getElementById("flt1_theTable").parentElement),gene_structure_colouring_element.innerHTML="",$("#variant_select").ddslick("destroy"),document.getElementsByClassName("fltrow")[0].childNodes[1].innerHTML="",variantdiv_str='<div id="variants_div">',variantdiv_str+="</div>",document.getElementsByClassName("fltrow")[0].childNodes[1].innerHTML=variantdiv_str,$("#variant_select").ddslick({width:"100%",onSelected:function(){gene_structure_radio_on_change()}})}function clickDetailsTextChange(e){if(null!=document.getElementById(e))if(document.getElementById(e).innerHTML==moreDetails){document.getElementById(e).setAttribute("hidden",!0);const t=document.getElementById(document.getElementById(e).name);t.textContent=t.getAttribute("name")}else if(document.getElementById(e).innerHTML==lessDetails){const t=e.substring(0,e.length-5);document.getElementById(t).removeAttribute("hidden");const n=document.getElementById(document.getElementById(e).name);n.textContent=truncateDescription(n.getAttribute("name"))}}function truncateDescription(e){if(null!=e||null!=e)return e.length>30?e.substring(0,30)+"...":e}let remainder_efp=0,efp_length=0,eFPSortedSRA=[],efp_RPKM_values=[];function populate_efp_modal(e){toggleResponsiveTable(2),$("#efpModalTable").empty(),efp_table_column="",eFPSortedSRA=[];const t=document.getElementsByClassName("colTitle");for(let n=2;n<t.length;n++){let e=t[n].id.substring(0,t[n].id.length-6);"none"!=document.getElementById(e+"_row").style.display&&eFPSortedSRA.push(e)}remainder_efp=eFPSortedSRA.length%11,efp_length=eFPSortedSRA.length,efp_RPKM_values=[];for(let n=0;n<eFPSortedSRA.length;n++)isNaN(parseFloat(sraDict[eFPSortedSRA[n]].RPKM))||efp_RPKM_values.push(parseFloat(sraDict[eFPSortedSRA[n]].RPKM));$("#efpModalTable").append(`\n\t\t\t<p class="eFP_thead">\n\t\t\t\tAGI-ID:\n\t\t\t\t\t<a href="https://www.arabidopsis.org/servlets/TairObject?type=locus&name=${locus} target="_blank" rel="noopener">\n\t\t\t\t\t\t${locus}\n\t\t\t\t\t</a>\n\t\t\t</p>\n\t\t`),"abs"===colouring_mode?$("#efpModalTable").append(`\n\t\t\t\t<p class="eFP_thead">\n\t\t\t\t\teFP Colour Scale:\n\n\t\t\t\t\t<img\n\t\t\t\t\t\tloading="lazy"\n\t\t\t\t\t\tsrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAPCAMAAAAlD5r/AAABQVBMVEX///8AAADcFDz/jAAAAP+m 3KYAfQD//wD//AD/+QD/9wD/9AD/8gD/7wD/7QD/6gD/6AD/5QD/4gD/4AD/3QD/2wD/2AD/1gD/ 0wD/0QD/zgD/zAD/yQD/xgD/xAD/wQD/vwD/vAD/ugD/twD/tQD/sgD/rwD/rQD/qgD/qAD/pQD/ owD/oAD/ngD/mwD/mQD/lgD/kwD/kQD/jgD/jAD/iQD/hwD/hAD/ggD/fwD/fAD/egD/dwD/dQD/ cgD/cAD/bQD/awD/aAD/ZgD/YwD/YAD/XgD/WwD/WQD/VgD/VAD/UQD/TwD/TAD/SQD/RwD/RAD/ QgD/PwD/PQD/OgD/OAD/NQD/MwD/MAD/LQD/KwD/KAD/JgD/IwD/IQD/HgD/HAD/GQD/FgD/FAD/ EQD/DwD/DAD/CgD/BwD/BQD/AgCkIVxRAAAAs0lEQVQ4jWNg5+Dk4ubh5eMXEBQSFhEVE5eQlJKW kZWTV1BUUlZRVVPX0NTS1tHV0zcwNDI2MTUzt7C0sraxtbN3cHRydnF1c/fw9PL28fXzDwgMCg4J DQuPiIyKjomNi09ITEpOSU1Lz8jMYhi1hERLGBmpbgljbBwjiiWMnFyMVLcECOhkCZBIZUzPYKSV JaDgYkxKZkxNY2SkmU8gljDCLaFdxDMmw4NrGOWTUUuItwQAG8496iMoCNwAAAAASUVORK5CYII="\n\t\t\t\t\t\tclass="colourScale"\n\t\t\t\t\t\talt="Absolute RPKM colour scale"\n\t\t\t\t\t/>\n\n\t\t\t\t\tMin: ${Math.min.apply(null,efp_RPKM_values).toFixed(1)} RPKM,\n\n\t\t\t\t\tMax: ${Math.max.apply(null,efp_RPKM_values).toFixed(1)} RPKM\n\t\t\t\t</p>\n\n\t\t\t\t<br />\n\n\t\t\t\t<table>\n\t\t\t\t\t<tbody class="eFP_tbody">\n\t\t\t\t</tbody>\n\t\t\t`):"rel"===colouring_mode&&$("#efpModalTable").append(`\n\t\t\t\t<p class="eFP_thead">\n\t\t\t\t\teFP Colour Scale:\n\n\t\t\t\t\t<img\n\t\t\t\t\t\tloading="lazy"\n\t\t\t\t\t\tsrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAPCAMAAAAlD5r/AAABQVBMVEX///8AAADcFDz/jAAAAP+m 3KYAfQAAAP8FBfkKCvQPD+8UFOoZGeUeHuAjI9soKNYtLdEzM8w4OMY9PcFCQrxHR7dMTLJRUa1W VqhbW6NgYJ5mZplra5NwcI51dYl6eoR/f3+EhHqJiXWOjnCTk2uZmWaenmCjo1uoqFatrVGysky3 t0e8vELBwT3GxjjMzDPR0S3W1ijb2yPg4B7l5Rnq6hTv7w/09Ar5+QX//wD/+wD/9gD/8QD/7AD/ 5wD/4gD/3QD/2AD/0wD/zQD/yAD/wwD/vgD/uQD/tAD/rwD/qgD/pQD/oAD/mgD/lQD/kAD/iwD/ hgD/gQD/fAD/dwD/cgD/bQD/ZwD/YgD/XQD/WAD/UwD/TgD/SQD/RAD/PwD/OgD/NAD/LwD/KgD/ JQD/IAD/GwD/FgD/EQD/DAD/BwBUljDTAAAA1klEQVQ4jWNg5+Dk4ubh5eMXEBQSFhEVE5eQlJKW kZWTV1BUUlZRVVPX0NTS1tHV0zcwNDI2MTUzt7C0sraxtbN3cHRydnF1c/fw9PL28fXzDwgMCg4J DQuPiIyKjomNi09ITEpOSU1Lz8jMYhi1hDRLGDi5GICWMBBvCSMjIUsYY+MYUS0BApJ8wmhlzUjI EiDAYgkD0CcMwgxUtQRIpDKmZzCiBBcDgwgDlSwBBRdjUjJjahojI2qcMAhT2RJGNEuAYUasJURH PGMyPLiGTz4ZtYQESwCEoDnh8dGTkQAAAABJRU5ErkJggg=="\n\t\t\t\t\t\tclass="colourScale"\n\t\t\t\t\t\talt="Relative RPKM colour scale"\n\t\t\t\t\t/>\n\n\t\t\t\t\tMin: ${Math.min.apply(null,efp_RPKM_values).toFixed(1)},\n\n\t\t\t\t\tMax: ${Math.max.apply(null,efp_RPKM_values).toFixed(1)}\n\t\t\t\t</p>\n\n\t\t\t\t<br />\n\n\t\t\t\t<table>\n\t\t\t\t\t<tbody>\n\t\t\t\t</tbody>\n\t\t\t`),$("#efpModalTable").append('<table id="eFPtable" class="table"></table>');for(let n=0;n<11*~~(eFPSortedSRA.length/11);n+=11)if("null"!=document.getElementById(eFPSortedSRA[n+10]).outerHTML){efp_table_column="<tr>";for(let e=0;e<11;e++)efp_table_column+=generateEFPTableItem(eFPSortedSRA[n+e],sraDict[eFPSortedSRA[n+e]].title);efp_table_column+="</tr>",$("#eFPtable").append(efp_table_column)}for(let n=0;n<12;n++)if(remainder_efp===n){efp_table_column="<tr>";for(let e=remainder_efp;e>0;e--)efp_table_column+=generateEFPTableItem(eFPSortedSRA[efp_length-e],sraDict[eFPSortedSRA[efp_length-e]].title);efp_table_column+="</tr>",$("#eFPtable").append(efp_table_column)}toggleResponsiveTable()}function generateEFPTableItem(e,t){return e&&t?`\n\t\t\t<td>\n\t\t\t\t<div\n\t\t\t\t\tclass="efp_table_tooltip"\n\t\t\t\t\tid="${e}_rep"\n\t\t\t\t\tonclick="ScrollToRNARow('${e}_row')"\n\t\t\t\t>\n\t\t\t\t\t${document.getElementById(e+"_svg").outerHTML}\n\t\t\t\t\t<span class="efp_table_tooltip_text">\n\t\t\t\t\t${e} - ${t}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</td>\n\t\t`:""}function change_rpkm_colour_scale(e){if(null===svg_colouring_element&&document.getElementById("flt3_theTable")&&document.getElementById("flt3_theTable").parentElement&&(svg_colouring_element=document.getElementById("flt3_theTable").parentElement),svg_colouring_element&&svg_colouring_element.innerHTML&&(svg_colouring_element.innerHTML=""),"rel"==e){const e=document.createElement("img");e.src="data:image/png;base64,"+relative_rpkm_scale,e.style="margin-top: 10px;",svg_colouring_element&&svg_colouring_element.appendChild(e)}else{const e=document.createElement("img");e.src="data:image/png;base64,"+absolute_rpkm_scale,e.style="margin-top: 10px;",e.alt="Absolute RPKM Scale",svg_colouring_element&&svg_colouring_element.appendChild(e)}const t=["colTitle","colRNA","colrpb","coleFP","colRPKM","colDetails"];let n=[];document.getElementsByClassName("fltrow")&&document.getElementsByClassName("fltrow")[0]&&(n=document.getElementsByClassName("fltrow")[0].getElementsByTagName("td"));for(let a=0;a<n.length;a++)n[a].style="border: 1px solid #D3D3D3",n[a].classList.add(t[a])}function locus_validation(){const e=document.getElementById("locus").value;9==e.length&&("A"==e[0]||"a"==e[0])&&("T"==e[1]||"t"==e[1])&&(e[2]>=1&&e[2]<=5||"C"==e[2]||"M"==e[2]||"c"==e[2]||"m"==e[2])&&("G"==e[3]||"g"==e[3])&&e[4]>=0&&e[4]<=9&&e[5]>=0&&e[5]<=9&&e[6]>=0&&e[6]<=9&&e[7]>=0&&e[7]<=9&&e[8]>=0&&e[8]<=9?$("#locus_button").removeAttr("disabled"):$("#locus_button").prop("disabled",!0)}function yscale_validation(){const e=document.getElementById("yscale_input").value;parseInt(e)>0||"Auto"==e||""==e?$("#locus_button").removeAttr("disabled"):$("#locus_button").prop("disabled",!0)}function rpkm_validation(){parseInt(document.getElementById("rpkm_scale_input").value)>0?$("#abs_scale_button").removeAttr("disabled"):$("#abs_scale_button").prop("disabled",!0)}const base_dataset_dictionary={"Araport 11 RNA-seq data":"cgi-bin/data/bamdata_araport11.xml","Developmental transcriptome - Klepikova et al":"cgi-bin/data/bamdata_Developmental_transcriptome.xml"};let databasesAdded=!1;function reset_database_options(){$(".userAdded").remove(),dataset_dictionary=base_dataset_dictionary,list_modified=!1,databasesAdded=!1}let xml_title,get_xml_list_output=[],user_exist=!1,list_modified=!1,check_for_change=0,match_title={},title_list=[];function get_user_XML_display(){const e=findAuthUser();""==users_email&&null==users_email&&null==users_email||users_email!==e?""!=users_email&&users_email!=e&&(signOut(),alert("Error occurred with your account, you have now been logged out. Please log back in")):$.ajax({url:"https://bar.utoronto.ca/webservices/eFP-Seq_Browser/get_xml_list.php?user="+users_email,dataType:"json",failure:function(){console.log("ERROR! Something went wrong")},success:function(e){xml_title=void 0,match_title={},title_list=[];let t=1,n=1;if(get_xml_list_output=e,"fail"==get_xml_list_output.status)console.log("Error code: "+get_xml_list_output.error),user_exist=!1;else if("success"==get_xml_list_output.status){if(user_exist=!0,check_for_change!=get_xml_list_output.files.length&&(reset_database_options(),list_modified=!1),check_for_change=get_xml_list_output.files.length,get_xml_list_output.files.length>0)for(let e=0;e<get_xml_list_output.files.length;e++){xml_title=void 0,xml_title=get_xml_list_output.files[e][1],xml_title&&0!==xml_title.trim()?.length&&"Uploaded dataset"!==xml_title?"Araport 11 RNA-seq data"==xml_title?(xml_title="Araport 11 RNA-seq data - Private version #"+n,n+=1):"Developmental transcriptome - Klepikova et al"==xml_title&&(xml_title="Developmental transcriptome - Klepikova et al - Private version #"+n,n+=1):(xml_title="Uploaded dataset - Unnamed dataset #"+t,t+=1),title_list.push(xml_title);const a=get_xml_list_output.files[e][0];match_title[xml_title]=a,e==get_xml_list_output.files.length-1&&create_data_list(get_xml_list_output.files.length)}setTimeout((function(){if(!list_modified)for(let e=0;e<get_xml_list_output.files.length;e++)dataset_dictionary[title_list[e]]=datalist_Title[title_list[e]],document.getElementById("xmlDatabase").innerHTML+=`\n\t\t\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\t\t\tclass="userAdded"\n\t\t\t\t\t\t\t\t\t\ttag="private"\n\t\t\t\t\t\t\t\t\t\tvalue="${title_list[e]}"\n\t\t\t\t\t\t\t\t\t\tid="${title_list[e]}"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t${title_list[e]}\n\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t`;list_modified=!0}),1e3)}databasesAdded=!0}})}let datalist=[],datalist_Title={};function create_data_list(e){if(datalist=[],datalist_Title={},e>0)for(let t=0;t<e;t++)$.ajax({url:"https://bar.utoronto.ca/webservices/eFP-Seq_Browser/get_xml.php?file="+match_title[title_list[t]],dataType:"json",success:function(e){const t=e;datalist.push(t.data)}}),t===e-1&&setTimeout((function(){dlCallLength=e,DatalistXHRCall(datalist)}),200)}let testDoc,dlCallLength=0,dlCallPosition=0;function DatalistXHRCall(e){if(dlCallPosition!=dlCallLength){const t=new XMLHttpRequest,n=e[dlCallPosition];t.responseType="document",t.onreadystatechange=()=>{if(t.readyState===XMLHttpRequest.DONE&&200===t.status){let n=t.responseXML;if(n){let t=n.getElementsByTagName("files")[0].attributes.xmltitle.nodeValue;datalist_Title[t]=e[dlCallPosition],dlCallPosition+=1,DatalistXHRCall(e)}}},t.open("GET",n),t.send()}}function validateEmail(e){return/\S+@\S+\.\S+/.test(e)}function findAuthUser(){return global_user&&global_user.email?global_user.email:""}function check_if_Google_login(){const e=findAuthUser();users_email&&e&&users_email===e?!1===databasesAdded&&(document.getElementById("private_dataset_header").style.display="block",get_user_XML_display()):(signOut(),remove_private_database())}function add_user_xml_by_upload(){get_user_XML_display(),setTimeout((function(){const e=findAuthUser();user_exist?user_exist&&(dataset_dictionary[datasetName]?dataset_dictionary[datasetName]&&(users_email===e?(list_modified=!1,check_for_change=0,$.ajax({url:"https://bar.utoronto.ca/webservices/eFP-Seq_Browser/delete_xml.php?user="+users_email+"&file="+match_title[datasetName]}),$.ajax({method:"POST",url:"https://bar.utoronto.ca/webservices/eFP-Seq_Browser/upload.php",data:{user:users_email,xml:upload_src,title:datasetName}})):""!=users_email&&users_email!=e&&(signOut(),alert("Error occurred with your account, you have now been logged out. Please log back in"))):users_email===e?$.ajax({method:"POST",url:"https://bar.utoronto.ca/webservices/eFP-Seq_Browser/upload.php",data:{user:users_email,xml:upload_src,title:datasetName}}):""!=users_email&&users_email!=e&&(signOut(),alert("Error occurred with your account, you have now been logged out. Please log back in"))):users_email===e?$.ajax({method:"POST",url:"https://bar.utoronto.ca/webservices/eFP-Seq_Browser/upload.php",data:{user:users_email,xml:upload_src,title:datasetName}}):""!=users_email&&users_email!=e&&(signOut(),alert("Error occurred with your account, you have now been logged out. Please log back in")),get_user_XML_display()}),1e4)}let uploadingData=!1;function which_upload_option(){uploadingData=!0;const e=findAuthUser();""!=users_email&&users_email===e?document.getElementById("upload_modal").click():""!=users_email&&users_email!=e?(signOut(),alert("Error occurred with your account, you have now been logged out. Please log back in")):""==users_email&&document.getElementById("upload_logX").click()}const public_dataset_dictionary={"Araport 11 RNA-seq data":"cgi-bin/data/bamdata_araport11.xml","Developmental transcriptome - Klepikova et al":"cgi-bin/data/bamdata_Developmental_transcriptome.xml"};let public_title_list=[],total_amount_of_datasets=0;function delete_fill(){$("#delete_fill").empty(),$("#publicDatabaseDownload").empty(),public_title_list=[];for(let t in public_dataset_dictionary)public_dataset_dictionary.hasOwnProperty(t)&&public_title_list.push(t);let e=0;total_amount_of_datasets=public_title_list.length+title_list.length;for(let t=0;t<public_title_list.length;t++)$("#publicDatabaseDownload").append(`\n\t\t\t\t<input\n\t\t\t\t\ttype="checkbox"\n\t\t\t\t\ttag="publicDataCheckbox"\n\t\t\t\t\tclass="publicDataCheckbox"\n\t\t\t\t\tonchange="disableDeletePublic()"\n\t\t\t\t\tid="deleteBox_${e}"\n\t\t\t\t\tvalue="${public_title_list[t]}"\n\t\t\t\t>\n\t\t\t\t\t${public_title_list[t]}\n\t\t\t\t</input>\n\t\t\t\t<br />\n\t\t\t`),e+=1;for(let t=0;t<title_list.length;t++)$("#delete_fill").append(`\n\t\t\t\t<input\n\t\t\t\t\ttype="checkbox"\n\t\t\t\t\ttag="privateDataCheckbox"\n\t\t\t\t\tclass="privateDataCheckbox"\n\t\t\t\t\tonchange="disableDeletePublic()"\n\t\t\t\t\tid="deleteBox_${e}"\n\t\t\t\t\tvalue="${title_list[t]}"\n\t\t\t\t>\n\t\t\t\t\t${title_list[t]}\n\t\t\t\t</input>\n\t\t\t\t<br />\n\t\t\t`),e+=1}let isDeletePublicDisabled=!1;function disableDeletePublic(){for(let e=0;e<public_title_list.length;e++){if(document.getElementById("deleteBox_"+e).checked&&"publicDataCheckbox"==document.getElementById("deleteBox_"+e).className){isDeletePublicDisabled||(document.getElementById("deleteXML_button").classList.add("disabled"),isDeletePublicDisabled=!0);break}isDeletePublicDisabled&&(document.getElementById("deleteXML_button").classList.remove("disabled"),isDeletePublicDisabled=!1)}}function CheckIfSelectedXML(){const e=findAuthUser();for(let t=0;t<title_list.length;t++){const n="deleteBox_"+(t+2);if(document.getElementById(n).checked&&users_email===e)return!0}if(1)return!1}function delete_selectedXML(){const e=findAuthUser();for(let t=0;t<title_list.length;t++){const n="deleteBox_"+(t+2);document.getElementById(n)&&document.getElementById(n).checked&&users_email===e&&$.ajax({url:"https://bar.utoronto.ca/webservices/eFP-Seq_Browser/delete_xml.php?user="+users_email+"&file="+match_title[document.getElementById(n).value]})}databasesAdded=!1}function confirm_deleteUser(){const e=findAuthUser();""!=users_email&&users_email===e&&$("#logoutModal").is(":visible")&&delete_allXMLs(e)}function delete_allXMLs(e){const t=findAuthUser();if(e===t){for(let e=0;e<title_list.length;e++){const n="deleteBox_"+(e+2);users_email===t&&$.ajax({url:"https://bar.utoronto.ca/webservices/eFP-Seq_Browser/delete_xml.php?user="+users_email+"&file="+match_title[document.getElementById(n).value]})}delete_user(),databasesAdded=!1}}function delete_user(){const e=findAuthUser();""!=users_email&&users_email===e&&$.ajax({url:"https://bar.utoronto.ca/webservices/eFP-Seq_Browser/delete_user.php?user="+users_email}),signOut()}let warningActive_index_XML="nope",warningActive_index_account="nope";function showWarning_index(e){1===e?isDeletePublicDisabled||("nope"==warningActive_index_XML?(document.getElementById("warning_index_xml").className="warning_index",warningActive_index_XML="yes"):"yes"==warningActive_index_XML&&hideWarning_index(e)):2===e&&("nope"==warningActive_index_account?(document.getElementById("warning_index_account").className="warning_index",warningActive_index_account="yes"):"yes"==warningActive_index_account&&hideWarning_index(e))}function hideWarning_index(e){1===e?(document.getElementById("warning_index_xml").className="warning_nope_index",warningActive_index_XML="nope"):2===e&&(document.getElementById("warning_index_account").className="warning_nope_index",warningActive_index_account="nope")}function manage_DownloadXML(){const e=title_list.length+2;for(let t=0;t<e;t++){const e="deleteBox_"+t;document.getElementById(e).checked&&($("#downloadXML").attr("href",dataset_dictionary[document.getElementById(e).value]).attr("download",document.getElementById(e).value+".xml"),document.getElementById("downloadXML_button").click())}}const table_base="\t\t<tr>\n\t\t\t<th>Title*</th>\n\t\t\t<th>Description*</th>\n\t\t\t<th>Record Number *</th>\n\t\t\t<th>RNA-Seq Data/BAM file repository link*</th>\n\t\t\t<th>Repository type*</th>\n\t\t\t<th>BAM Filename*</th>\n\t\t\t<th>Publication Link</th>\n\t\t\t<th>SRA/NCBI Link</th>\n\t\t\t<th>Total Reads Mapped*</th>\n\t\t\t<th>Read Map Method</th>\n\t\t\t<th>Species*</th>\n\t\t\t<th>Tissue*</th>\n\t\t\t<th>Tissue subunit*</th>\n\t\t\t<th>Controls</th>\n\t\t\t<th>Replicate Controls</th>\n\t\t</tr>\n";function fill_tableCSV(){$("#XMLtoCSVtable").empty();for(let e=0;e<total_amount_of_datasets;e++){const t="deleteBox_"+e;$.ajax({url:dataset_dictionary[document.getElementById(t).value],dataType:"xml",failure:function(){console.log("Failed at opening XML for conversion into a CSV file. Please contact an admin")},success:function(e){let t;$(e).find("files").each((function(){t=$(this).attr("xmltitle"),""!=t&&"Uploaded dataset"!=t||(t="Uploaded dataset"),t=t.split(" ").join("_")}));const n=$(e).find("file");let a="";a+="<table id='"+t+"'>\n\t<tbody>\n",a+="\t\t<caption>"+t+"</caption>\n",a+=table_base,n.each((function(){a+="\t\t<tr>\n";const e=$(this).attr("description");a+="\t\t\t<td>"+e+"</td>\n";const t=$(this).attr("info");a+="\t\t\t<td>"+t+"</td>\n";const n=$(this).attr("record_number");a+="\t\t\t<td>"+n+"</td>\n";const o=$(this).attr("name");a+="\t\t\t<td>"+o+"</td>\n";const s=$(this).attr("bam_type");a+="\t\t\t<td>"+s+"</td>\n";let l=$(this).attr("filename");null!=l&&"undefined"!==l&&".bam"!==l||(l="accepted_hits.bam"),a+="\t\t\t<td>"+l+"</td>\n";const i=$(this).attr("publication_link");a+="\t\t\t<td>"+i+"</td>\n";const r=$(this).attr("url");a+="\t\t\t<td>"+r+"</td>\n";let d=$(this).attr("total_reads_mapped");null!=d&&""!=d||(d="0"),a+="\t\t\t<td>"+d+"</td>\n";const c=$(this).attr("read_map_method");a+="\t\t\t<td>"+c+"</td>\n";let u=$(this).attr("species");null!=u&&""!=u||(u="Arabidopsis thaliana"),a+="\t\t\t<td>"+u+"</td>\n";const m=$(this).attr("svgname");a+="\t\t\t<td>"+m+"</td>\n";const g=$(this).attr("svg_subunit");a+="\t\t\t<td>"+g+"</td>\n";let p="";if($(this).find("controls")[0].innerHTML)for(let a=1;a<$(this).find("controls")[0].childNodes.length;a+=2)$(this).find("controls")[0].childNodes[a].firstChild&&(p+=$(this).find("controls")[0].childNodes[a].firstChild.textContent,a<$(this).find("controls")[0].childNodes.length-2&&(p+=", "));a+="\t\t\t<td>"+p+"</td>\n";let _="";if($(this).find("groupwith")[0].innerHTML)for(let a=1;a<$(this).find("groupwith")[0].childNodes.length;a+=2)$(this).find("groupwith")[0].childNodes[a].firstChild&&(_+=$(this).find("groupwith")[0].childNodes[a].firstChild.textContent,a<$(this).find("groupwith")[0].childNodes.length-2&&(_+=", "));a+="\t\t\t<td>"+_+"</td>\n",a+="\t\t</tr>\n"})),a+="\t</tbody>\n</table>",document.getElementById("XMLtoCSVtable").innerHTML+=a}})}}function download_XMLtableCSV(){for(let e=0;e<total_amount_of_datasets;e++){const t="deleteBox_"+e;if(document.getElementById(t).checked){const e=document.getElementById(t).value.split(" ").join("_");$("#"+e).tableToCSV()}}}const downloadIndexTable_base="\t\t<tr>\n\t\t\t<th>Title</th>\n\t\t\t<th>Record Number</th>\n\t\t\t<th>Tissue</th>\n\t\t\t<th>Tissue subunit</th>\n\t\t\t<th>Locus</th>\n\t\t\t<th>bp Length</th>\n\t\t\t<th>bp Start site</th>\n\t\t\t<th>bp End site</th>\n\t\t\t<th>Total number of reads</th>\n\t\t\t<th>Reads mapped to locus</th>\n\t\t\t<th>rpb</th>\n\t\t\t<th>RPKM</th>\n\t\t\t<th>Controls</th>\n\t\t</tr>\n";function download_mainTableCSV(){document.getElementById("download_icon").classList.add("progressLoading"),document.getElementById("bodyContainer").classList.add("progressLoading"),populate_efp_modal(1),$("#hiddenDownloadModal_table").empty();let e="<table id='downloadIndexTable'>\n\t<tbody>\n";e+="\t\t<caption>"+datasetName.split(" ").join("_")+"</caption>\n",e+=downloadIndexTable_base;for(const t of eFPSortedSRA)e+="\t\t<tr>\n",e+="\t\t\t<td>"+sraDict[t].title+"</td>\n",e+="\t\t\t<td>"+t+"</td>\n",e+="\t\t\t<td>"+sraDict[t].svg.substr(4,sraDict[t].svg.length-8)+"</td>\n",e+="\t\t\t<td>"+sraDict[t].svg_part+"</td>\n",e+="\t\t\t<td>"+sraDict[t].locusValue+"</td>\n",e+="\t\t\t<td>"+String(sraDict[t].bp_length)+"</td>\n",e+="\t\t\t<td>"+String(sraDict[t].bp_start)+"</td>\n",e+="\t\t\t<td>"+String(sraDict[t].bp_end)+"</td>\n",e+="\t\t\t<td>"+sraDict[t].numberofreads+"</td>\n",e+="\t\t\t<td>"+String(sraDict[t].MappedReads)+"</td>\n",e+="\t\t\t<td>"+sraDict[t].rpb+"</td>\n",e+="\t\t\t<td>"+String(sraDict[t].RPKM[variantPosition].toFixed(2))+"</td>\n",e+="\t\t\t<td>"+String(sraDict[t].controlsString)+"</td>\n",e+="\t\t</tr>\n";e+="\t</tbody>\n</table>",document.getElementById("hiddenDownloadModal_table").innerHTML+=e,$("#hiddenDownloadModal_table").tableToCSV(),document.getElementById("download_icon").classList.remove("progressLoading"),document.getElementById("bodyContainer").classList.remove("progressLoading")}let publicData=!0;function changePublicData(e=!1){publicData=!e&&!uploadingData&&(1==document.getElementById("xmlDatabase").selectedIndex||2==document.getElementById("xmlDatabase").selectedIndex)}let isPrecache=!0;function checkPreload(){if(get_input_values(),verifyLoci(locus)){loadingScreen(!1),progress_percent=0,document.title=`eFP-Seq Browser: Loading 0% - ${locus}`,document.getElementById("progress").title="0%",$("div#progress").width(progress_percent+"%");for(const e in public_dataset_dictionary){if(base_src===public_dataset_dictionary[e]){publicData=!0;break}publicData=!1}publicData&&"AT2G24270"==locus&&"simple"==dumpMethod&&!callDumpOutputs?(variants_radio_options(1),isPrecache=!0):(update_all_images(0),isPrecache=!1)}else console.error(`The following locus is not valid: ${locus}`)}function verifyLoci(e){if("string"==typeof e){const t=new RegExp("^[A][T][MC0-9][G][0-9]{5}[.][0-9]{1,2}$|^[A][T][MC0-9][G][0-9]{5}$","i");return e.trim().match(t)}return!1}let parse_output,GFF_List=[];function getGFF(e){GFF_List=[],$.ajax({url:`https://bar.utoronto.ca/webservices/bar_araport/gene_structure_by_locus.php?locus=${e}`,dataType:"json",crossDomain:!0,headers:{"Access-Control-Allow-Origin":"*"},failure:function(){console.log("Getting GFFs (getGFF) information failed to retrieve locus information from Araport11")},success:function(e){if(parse_output=e,parse_output.wasSuccessful){let e=parse_output.features[0].subfeatures;for(let t=0;t<e.length;t++)null!=e[t].uniqueID?GFF_List.push(e[t].uniqueID):GFF_List.push("Error retrieving unique ID/GFF")}else"fail"==parse_output.status?console.log("Error: Cannot find GFF ID's with parse output. Please contact admin"):"false"==parse_output.wasSuccessful&&(null!=parse_output.error?console.log("Error: Cannot find GFF ID's due to following error: "+parse_output.error+". Please contact admin"):console.log("Error: Cannot find GFF ID's with parse output. Please contact admin"))}})}function addGFF(){if(document.getElementsByClassName("dd-option").length>0)for(let e=0;e<GFF_List.length;e++)document.getElementsByClassName("dd-option")[e]&&document.getElementsByClassName("dd-option")[e].setAttribute("title",GFF_List[e])}function hiddenGoogleSignin(){const e=document.getElementsByClassName("abcRioButtonLightBlue");for(let t=0;t<e.length;t++)e[t]&&e[t].setAttribute("id","loginClick"+t)}function remove_private_database(){databasesAdded=!1,document.getElementById("private_dataset_header").style.display="none";const e=document.getElementsByClassName("userAdded");for(let t=0;t<e.length;t++)$("#xmlDatabase option:last").remove();check_for_change=0}function correctAGIIDInput(){if(document.getElementById("locus")&&document.getElementById("locus").value&&document.getElementById("locus").value.trim().length>0){const e=document.getElementById("locus").value.trim().split("/");e[0]?document.getElementById("locus").value=e[0].toUpperCase().trim():document.getElementById("locus").value=document.getElementById("locus").value.trim(),locus_validation()}}function returnBackToTop(){document.getElementById("main_content").scrollTop=0}function toggleOptionsTable(){"false"===document.getElementById("tableToggle").getAttribute("aria-expanded")?(document.getElementById("tableToggle").setAttribute("aria-expanded",!0),document.getElementById("filterDropdown").classList.add("show")):(document.getElementById("tableToggle").setAttribute("aria-expanded",!1),document.getElementById("filterDropdown").classList.remove("show"))}function toggleTableOptionsView(){document.getElementById("tableFilter-tab").classList.value.includes("active")?(document.getElementById("tableFilter-tab").classList.remove("active"),document.getElementById("eFPFilter-tab").classList.add("active"),document.getElementById("tableFilter").classList.remove("show","active"),document.getElementById("eFPFilter").classList.add("show","active")):(document.getElementById("tableFilter-tab").classList.add("active"),document.getElementById("eFPFilter-tab").classList.remove("active"),document.getElementById("tableFilter").classList.add("show","active"),document.getElementById("eFPFilter").classList.remove("show","active"))}let downloadDivNum=1;function downloadDiv(e){html2canvas(document.getElementById(e)).then((e=>{$("#appendCanvas").empty(),e.id="downloadDivNum_"+downloadDivNum,document.getElementById("appendCanvas").appendChild(e),document.getElementById("downloadDivNum_"+downloadDivNum).style.width="100%",$("#DownloadImageModal").modal("toggle"),downloadDivNum++}))}function displayNavBAR(e=!1){const t=$("#navbar_menu").is(":visible")||e;document.getElementById("navbar_menu").style.display=t?"none":"block",document.getElementById("main_content").className=t?"col-sm-12":"col-sm-9",document.getElementById("openMenu").style.display=t?"block":"none",document.getElementById("theTable")&&(t?document.getElementById("theTable").classList.add("RNATable"):document.getElementById("theTable").classList.remove("RNATable"))}function adjustFooterSize(){const e=document.getElementById("navbar_menu");e&&(document.getElementById("nm_footer").style.width=e.offsetWidth+"px",e.scrollHeight==e.clientHeight?document.getElementById("nm_footer").classList.contains("navbar_menu_footer_overflow_abs")||(document.getElementById("nm_footer").classList.remove("navbar_menu_footer_overflow_sticky"),document.getElementById("nm_footer").classList.add("navbar_menu_footer_overflow_abs")):e.scrollHeight>e.clientHeight&&(document.getElementById("nm_footer").classList.contains("navbar_menu_footer_overflow_sticky")||(document.getElementById("nm_footer").classList.remove("navbar_menu_footer_overflow_abs"),document.getElementById("nm_footer").classList.add("navbar_menu_footer_overflow_sticky"))))}function adjustTableOptionsDropdownSize(){document.getElementById("filterDropdown").style.left=(document.body.offsetWidth-2*document.getElementById("tableToggle").offsetWidth-document.getElementById("filterDropdown").offsetWidth).toString()+"px"}function adjustSubmissionIFrameSize(){const e=.7*window.innerHeight;document.getElementById("submissioniframe").height=e+"px"}let usedToggle=!1;function toggleTableCol(e,t){const n=document.getElementsByClassName(e);if(t)for(const a of n)a&&a.removeAttribute("hidden");else if(!t)for(const a of n)a&&a.setAttribute("hidden",!0)}let responsiveRNAWidthAdjusted=!1;function responsiveRNAWidthResize(){const e=document.getElementsByClassName("responsiveRNAWidth");if(window.innerWidth<=575){for(let t=0;t<e.length;t++)e[t].style.minWidth=.93*window.innerWidth+"px";responsiveRNAWidthAdjusted=!0}else if(window.innerWidth>575&&responsiveRNAWidthAdjusted)for(let t=0;t<e.length;t++)e[t].style.minWidth="420px"}function toggleResponsiveTableOptions(e,t,n,a,o,s,l){toggleTableCol("colTitle",e),document.getElementById("toggleTitle").checked=e,toggleTableCol("colRNA",t),document.getElementById("toggleRNA").checked=t,toggleTableCol("colrpb",n),document.getElementById("togglerpb").checked=n,toggleTableCol("coleFP",a),document.getElementById("toggleeFP").checked=a,toggleTableCol("colRPKM",o),document.getElementById("toggleRPKM").checked=o,toggleTableCol("colDetails",s),document.getElementById("toggleDetails").checked=s,toggleTableCol("colCompare",l),document.getElementById("toggleCompare").checked=l,RememberToggleOptions(e,t,n,a,o,s,l)}function determineResponsiveTable(){document.body.offsetWidth<=576?(toggleResponsiveTable(2),displayNavBAR(!0)):toggleResponsiveTable(0)}function toggleResponsiveTable(e=0){"none"!=document.getElementById("tableToggle").style.display&&(1==e||window.innerWidth<=575&&!usedToggle?toggleResponsiveTableOptions(!1,!0,!1,!1,!1,!1,!1):2==e||window.innerWidth>=1100&&!usedToggle?toggleResponsiveTableOptions(!0,!0,!0,!0,!0,!0,!1):3==e||window.innerWidth<830&&!usedToggle?toggleResponsiveTableOptions(!0,!0,!1,!1,!1,!1,!1):4==e||window.innerWidth<900&&!usedToggle?toggleResponsiveTableOptions(!0,!0,!0,!1,!1,!1,!1):5==e||window.innerWidth<990&&!usedToggle?toggleResponsiveTableOptions(!0,!0,!0,!1,!0,!1,!1):(6==e||window.innerWidth<1100&&!usedToggle)&&toggleResponsiveTableOptions(!0,!0,!0,!0,!0,!1,!1))}let ToggledTable=[!0,!0,!0,!0,!0,!0,!1];function RememberToggleOptions(e=!0,t=!0,n=!0,a=!0,o=!0,s=!0,l=!1){ToggledTable=[e,t,n,a,o,s,l]}const colSortList=["colTitle","colrpb","colRPKM","colDetails"];function ResizeArrowRow(){for(const e of colSortList){const t=e+"Row";document.getElementById(t).style.width=document.getElementById(t).parentNode.offsetWidth-2+"px";CheckElementWidth(e+"Arrow",8)}}function CheckElementWidth(e,t){document.getElementById(e).offsetWidth<t&&(document.getElementById(e).style.width=t+"px")}function ChangeColArrow(e){setTimeout((function(){const t=e+"Arrow";document.getElementById(e).classList.contains("headerSortDown")?document.getElementById(t).src="./cgi-bin/SVGs/arrowSortDown.min.svg":document.getElementById(e).classList.contains("headerSortUp")&&(document.getElementById(t).src="./cgi-bin/SVGs/arrowSortUp.min.svg");for(const e of colSortList){CheckElementWidth(e+"Arrow",8)}}),100)}function ScrollToRNARow(e){document.getElementById("closemodal_efPOverview").click(),$("#main_content").animate({scrollTop:$("#"+e).offset().top},"slow"),document.getElementById(e)&&(document.getElementById(e).className+=" scrollToRow",setTimeout((function(){document.getElementById(e).className+=" scrollToRowRemove"}),2e3),setTimeout((function(){document.getElementById(e).classList.remove("scrollToRow"),document.getElementById(e).classList.remove("scrollToRowRemove")}),4050))}function IfPressEnter(e,t){13!=e.which&&13!=e.keyCode||$("#"+t).click()}let shareLink,BrowserDetected=!1;function DetectBrowser(){if(!1===BrowserDetected){const e={"Microsoft+Edge":{Contain:["Edge"]},Opera:{Contain:["OPR","Opera"]},Firefox:{Contain:["Firefox"],NContain:["Seamonkey"]},Seamonkey:{Contain:["Seamonkey"]},Chrome:{Contain:["Chrome"],NContain:["Chromium"]},Chromium:{Contain:["Chromium"]},"Internet+Explorer":{Contain:["MSIE"]},Safari:{Contain:["Safari"],NContain:["Chromium","Chrome"]}};let t,n;e?t=Object.keys(e):logError("Unable retrieve userAgentParser");let a=!0;for(const o of t)for(let t=0;t<e[o].Contain.length;t++)if(a&&-1!==navigator.userAgent.indexOf(e[element].Contain[t])){if(!e[element].NContain){n=element,a=!1;break}{const t=e[element].NContain.length;let o=0;if(e[element].NContain.forEach((e=>{-1!==navigator.userAgent.indexOf(e)&&o++})),o!=t){n=element,a=!1;break}}}if(n){$("#notChrome").empty();const e=' or through the following <a href="https://www.google.com/search?q=manage+cookies+in+'+n+'" target="_blank" rel="noopener">Google search results</a>';$("#notChrome").append(e)}BrowserDetected=!0}}function CreateFilteredeFPList(){if($("#filtereFPList").empty(),tissueSRADic){const e=Object.keys(tissueSRADic);for(const t of e){let e='<li class="form-check">';e+='<input class="form-check-input" type="checkbox" id="'+t.replace(" ","_")+'" onclick="ToggleFilteredeFP(this.id, this.checked);" style="margin: 6px 5px 0;" value="toggleeFP" checked>',e+='<p class="form-check-label" for="toggleTitle" style="padding-left: 20px; font-weight: 10;">'+t+"</p>",e+="</li>",$("#filtereFPList").append(e)}}else logError("Unable to use tissueSRADic")}function ToggleFilteredeFP(e,t){const n=e.replace("_"," "),a=tissueSRADic[n];if(!0===t)for(let o=0;o<a.length;o++)document.getElementById(a[o]+"_row")&&document.getElementById(a[o]+"_row").removeAttribute("hidden");else if(!1===t)for(let o=0;o<a.length;o++)document.getElementById(a[o]+"_row")&&document.getElementById(a[o]+"_row").setAttribute("hidden",!0)}function LoadSubmittedData(){emptyLanding(),progress_percent=0,document.title=`eFP-Seq Browser: Loading 0% - ${locus}`,loadingScreen(!1),setTimeout((function(){count_bam_num(),disableAllComparison()}),200),update_all_images(0)}function generateShareLink(e=!1){let t="https://"+window.location.host+window.location.pathname;t+="?locus="+locus+"&dataset="+base_src,shareLink=t,e&&window.history.pushState&&window.history.pushState({},"Title",window.location.pathname+"?locus="+locus+"&dataset="+base_src),document.getElementById("shareLinkTextArea").textContent=shareLink}const shareLinkInputs={};function readShareLink(){const e=window.location.search.substr(1);let t=!1,n=!1;if(""!=e){const a=e.split("&");for(const e of a){const a=e.split("=");if(a.length>1)if("locus"===a[0].split("%20").join(" ").trim()){const n=e.substring(6).split("%20").join(" ").trim();shareLinkInputs.locus=n,document.getElementById("locus").value=n,t=!0}else if("dataset"===a[0].split("%20").join(" ").trim()){const t=e.substring(8).split("%20").join(" ").trim();shareLinkInputs.dataset=t,base_src=t,n=!0}}t&&n?(emptyLanding(),progress_percent=0,document.title=`eFP-Seq Browser: Loading 0% - ${locus}`,sraDict={},sraCountDic={},loadNewDataset=!1,setTimeout((function(){count_bam_num(),disableAllComparison(),checkPreload()}),200),toggleResponsiveTable(0)):displayError(t&&!1===n?"ERROR IN SHARE LINK! Missing dataset":!1===t&&n?"ERROR IN SHARE LINK! Missing locus":"ERROR IN SHARE LINK! Missing locus and dataset")}}function copyToClipboard(){""!==document.getElementById("shareLinkTextArea").trim()&&(document.getElementById("shareLinkTextArea").select(),document.execCommand("copy"))}let allCheckedOptions=[];function tableCheckbox(e,t=!1){const n=e.split("_")[0];if(t)disableAllComparison();else if(!1===t&&document.getElementById(e)&&document.getElementById(e).checked){allCheckedOptions.push(n);const t={};for(let e=0;e<GFF_List.length;e++){let a='<tr class="compareDataRow" id="'+n+"_compareRow"+e+'">';parseInt(e)===parseInt(variantPosition)?a+='<td style="width: 250px; font-size: 12px;" id="'+n+"_compareTitle"+e+'">'+document.getElementById(n+"_title").innerHTML+" ... ("+GFF_List[e]+")</td>\n":a+='<td style="width: 250px; font-size: 12px;" id="'+n+"_compareTitle"+e+'">^^^ ... ('+GFF_List[e]+")</td>\n",a+='<td style="max-width: 576px;"><img loading="lazy" id="'+n+"_rnaseq_img"+e+'" alt="RNA-Seq mapped image for:'+n+'" style="min-width:420px; max-width:576px; width:95%; height: auto;" src="" /><br/><img loading="lazy" id="'+n+"_gene_structure_img"+e+'" style="max-width: 576px; width:100%; height: auto;" src="" alt="Gene variant image for:'+n+'"/></td>\n',a+='<td id="'+n+"_rpb"+e+'" style="font-size: 12px; width: 50px; ">'+sraDict[n].r[e].toFixed(2)+"</td>",a+='<td tag="svg_name" style="width:  75px;"><div id="'+n+"_svg"+e+'" name="'+sraDict[n].svg.substr(4).replace(".","_")+'_tissue" tag='+sraDict[n].svg_part+'_subtissue" width="75" height="75" style="width: 75px; height: 75px; max-width: 75px; max-height: 75px;">'+document.getElementById(sraDict[n].svg.substr(4).replace(".svg","_svg")).innerHTML+'</div><div class="mdl-tooltip" for="'+n+"_svg"+e+'">'+sraDict[n].svg.substring(4).replace(".svg","")+"</div></td>\n",a+='<td id="'+n+"_rpkm"+e+'" style="font-size: 12px; width: 50px; ">'+sraDict[n].RPKM[e].toFixed(2)+"</td>",parseInt(e)===parseInt(variantPosition)?a+='<td style="width: 250px; font-size: 12px;" id="'+n+"_compareTitle"+e+'"><div id="'+n+'_descriptionCompare" name="'+document.getElementById(n+"_description").getAttribute("name")+'">'+document.getElementById(n+"_description").innerHTML+'</div><div id="igbLinkCompare_'+n+'">'+document.getElementById("igbLink_"+n).innerHTML+'</div><div id="extraLinksCompare_'+n+'">'+document.getElementById("extraLinks_"+n).innerHTML+"</div></td>\n":a+='<td style="width: 250px; font-size: 12px;" id="'+n+"_compareTitle"+e+'">^^^</td>\n',a+="</tr>",t[e]=n+"_compareRow"+e,document.getElementById("compareTable").innerHTML+=a,document.getElementById(n+"_rnaseq_img"+e)&&document.getElementById(n+"_rnaseq_img"+e).setAttribute("src",document.getElementById(n+"_rnaseq_img").src),document.getElementById(n+"_gene_structure_img"+e)&&document.getElementById(n+"_gene_structure_img"+e).setAttribute("src",document.getElementsByClassName("dd-option-image")[e].src),sraDict[n].RPKM&&sraDict[n].RPKM[e]&&colour_part_by_id(n+"_svg"+e,sraDict[n].svg_part,sraDict[n].RPKM[e],colouring_mode)}document.getElementById(e).checked=!0,document.getElementById("allCheckbox").checked=!0,"rel"!=colouring_mode&&(document.getElementById("compareGeneVariants").disabled=!1)}else!1===t?(disableCompare(n),allCheckedOptions.splice(allCheckedOptions.indexOf(n),1),document.getElementById(e).checked=!1):!0===t&&disableAllComparison(),0===allCheckedOptions.length&&(document.getElementById("compareGeneVariants").disabled=!0)}function disableCompare(e){for(let t=0;t<GFF_List.length;t++)null!=document.getElementById(e+"_compareRow"+t)&&document.getElementById(e+"_compareRow"+t).remove()}function disableAllComparison(){if(document.getElementById("allCheckbox")){let e=document.getElementsByClassName("compareDataRow");for(let a=e.length-1;a>=0;a--)document.getElementsByClassName("compareDataRow")[a].remove();allCheckedOptions=[],e=document.getElementsByClassName("compareCheckbox");for(let a=0;a<e.length;a++)document.getElementsByClassName("compareCheckbox")[a].checked=!1;document.getElementById("allCheckbox").checked=!1;const t=[],n=document.getElementsByClassName("mainEntries");for(let a=0;a<n.length;a++){const e=n[a].id;!1===t.includes(e)?t.push(e):document.getElementsByClassName("mainEntries")[a].remove()}document.getElementById("compareGeneVariants").disabled=!0}}function PnCDisappear(){document.getElementById("PrivacyAndCookies").setAttribute("hidden",!0),document.cookie="eSBAcceptedCookies=1; expires=Friday, December 31, 9999 at 7:00:00 AM; SameSite=Lax; Secure",document.cookie="eSBVersion="+version+"; expires=Friday, December 31, 9999 at 7:00:00 AM; SameSite=Lax; Secure"}function setUpCookies(){const e=document.cookie.split(";");let t,n;for(const a of e){const e=a.split("=");if(e[0]&&"eSBAcceptedCookies"===e[0].trim()&&(t=e[1].trim()),e[0]&&"eSBVersion"===e[0].trim()&&(n=e[1].trim()),t&&n)break}t&&"1"===t?document.getElementById("PrivacyAndCookies").setAttribute("hidden",!1):document.getElementById("PrivacyAndCookies").removeAttribute("hidden"),n&&n!==version&&(document.getElementById("PrivacyAndCookies").removeAttribute("hidden"),document.cookie="eSBAcceptedCookies=0; SameSite=Lax; Secure")}function displayVersionNumber(){document.getElementById("feedbackText").innerHTML+="<br><br>The eFP-Seq Browser's current version number is: "+version}function init(){document.getElementById("locus").value="AT2G24270",document.getElementById("xmlDatabase").value="Araport 11 RNA-seq data",locus_validation(),old_locus=locus,yscale_validation(),rpkm_validation(),adjustFooterSize(),displayVersionNumber(),adjustTableOptionsDropdownSize(),setUpCookies(),$("input[type=radio][name=radio_group]").change((function(){gene_structure_radio_on_change()})),$("#locus").keyup((function(){locus_validation()})),$("#yscale_input").keyup((function(){yscale_validation()})),$("#rpkm_scale_input").keyup((function(){rpkm_validation()})),document.getElementsByClassName("abcRioButtonLightBlue").length>0&&hiddenGoogleSignin(),getGFF(locus),$("#locus").autocomplete({source:function(e,t){const n=e.term.split(/,\s*/).pop();$.ajax({type:"GET",url:"https://bar.utoronto.ca/webservices/eFP-Seq_Browser/idautocomplete.cgi?species=Arabidopsis_thaliana&term="+n,dataType:"json"}).done((function(e){e&&e.length>=7?t(e.slice(0,7)):t(e)}))},close:function(e,t){correctAGIIDInput()}});const e=document.getElementById("submissioniframe");e&&e.setAttribute("src",e.getAttribute("data-src")),adjustSubmissionIFrameSize(),readShareLink()}$(window).resize((function(){adjustFooterSize(),adjustSubmissionIFrameSize(),responsiveRNAWidthResize(),toggleResponsiveTable(),adjustTableOptionsDropdownSize(),setTimeout((function(){adjustFooterSize()}),10)})),adjustFooterSize(),window.addEventListener("load",(function(){init()}));